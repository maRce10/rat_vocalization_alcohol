<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Marcelo Araya-Salas">
<meta name="dcterms.date" content="2023-11-17">

<title>Classifying USV subtypes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="checking_annotations_files/libs/clipboard/clipboard.min.js"></script>
<script src="checking_annotations_files/libs/quarto-html/quarto.js"></script>
<script src="checking_annotations_files/libs/quarto-html/popper.min.js"></script>
<script src="checking_annotations_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="checking_annotations_files/libs/quarto-html/anchor.min.js"></script>
<link href="checking_annotations_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="checking_annotations_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="checking_annotations_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="checking_annotations_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="checking_annotations_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="checking_annotations_files/libs/quarto-diagram/mermaid.min.js"></script>
<script src="checking_annotations_files/libs/quarto-diagram/mermaid-init.js"></script>
<link href="checking_annotations_files/libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="qmd.css">
</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul class="collapse">
  <li><a href="#purpose" id="toc-purpose" class="nav-link active" data-scroll-target="#purpose"><span class="header-section-number">1</span> Purpose</a></li>
  <li><a href="#describe-annotations-single-element-subtypes" id="toc-describe-annotations-single-element-subtypes" class="nav-link" data-scroll-target="#describe-annotations-single-element-subtypes"><span class="header-section-number">2</span> Describe annotations (single element subtypes)</a></li>
  <li><a href="#data-analysis" id="toc-data-analysis" class="nav-link" data-scroll-target="#data-analysis"><span class="header-section-number">3</span> Data analysis</a></li>
  <li><a href="#measure-acoustic-structure" id="toc-measure-acoustic-structure" class="nav-link" data-scroll-target="#measure-acoustic-structure"><span class="header-section-number">4</span> Measure acoustic structure</a></li>
  <li><a href="#multi-element-composed-subtypes" id="toc-multi-element-composed-subtypes" class="nav-link" data-scroll-target="#multi-element-composed-subtypes"><span class="header-section-number">5</span> Multi-element composed subtypes</a>
  <ul class="collapse">
  <li><a href="#rules-to-determine-composed-subtypes" id="toc-rules-to-determine-composed-subtypes" class="nav-link" data-scroll-target="#rules-to-determine-composed-subtypes"><span class="header-section-number">5.1</span> Rules to determine composed subtypes</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6</span> Summary</a></li>
  <li><a href="#create-spectrograms" id="toc-create-spectrograms" class="nav-link" data-scroll-target="#create-spectrograms"><span class="header-section-number">7</span> Create spectrograms</a>
  <ul class="collapse">
  <li><a href="#single-element-subtypes" id="toc-single-element-subtypes" class="nav-link" data-scroll-target="#single-element-subtypes"><span class="header-section-number">7.1</span> Single element subtypes</a></li>
  <li><a href="#composed-subtypes" id="toc-composed-subtypes" class="nav-link" data-scroll-target="#composed-subtypes"><span class="header-section-number">7.2</span> Composed subtypes</a></li>
  <li><a href="#on-single-element-subtypes" id="toc-on-single-element-subtypes" class="nav-link" data-scroll-target="#on-single-element-subtypes"><span class="header-section-number">7.3</span> On single element subtypes</a></li>
  <li><a href="#on-composed-multi-element-subtypes" id="toc-on-composed-multi-element-subtypes" class="nav-link" data-scroll-target="#on-composed-multi-element-subtypes"><span class="header-section-number">7.4</span> On composed (multi-element) subtypes</a></li>
  <li><a href="#on-single-and-composed-multi-element-subtypes" id="toc-on-single-and-composed-multi-element-subtypes" class="nav-link" data-scroll-target="#on-single-and-composed-multi-element-subtypes"><span class="header-section-number">7.5</span> On single and composed (multi-element) subtypes</a></li>
  </ul></li>
  <li><a href="#to-do-list" id="toc-to-do-list" class="nav-link" data-scroll-target="#to-do-list"><span class="header-section-number">8</span> To-do list</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Classifying USV subtypes</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Rat vocalization and alcohol</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><a href="https://marce10.github.io/">Marcelo Araya-Salas</a> </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 17, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<style>
body
  { counter-reset: source-line 0; }
pre.numberSource code
  { counter-reset: none; }
</style>
<p>Source code and data found at <a href="https://github.com/maRce10/rat_vocalization_alcohol">https://github.com/maRce10/rat_vocalization_alcohol</a></p>
<p>&nbsp;</p>
<!-- skyblue box -->
<section id="purpose" class="level1 alert alert-info" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Purpose</h1>
<ul>
<li>Classify subtypes based on structure</li>
<li>Determine multi-element subtypes based on composing single subtypes</li>
</ul>
</section>
<p>&nbsp;</p>
<section id="load-packages" class="level1 unnumbered unlisted">
<h1 class="unnumbered unlisted">Load packages</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># knitr is require for creating html/pdf/word reports formatR is</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="co"># used for soft-wrapping code</span></span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># install/ load packages</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>sketchy<span class="sc">::</span><span class="fu">load_packages</span>(<span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"knitr"</span>, <span class="st">"formatR"</span>, <span class="st">"viridis"</span>,</span>
<span id="cb1-6"><a href="#cb1-6"></a>    <span class="st">"warbleR"</span>, <span class="at">github =</span> <span class="st">"maRce10/Rraven"</span>, <span class="at">github =</span> <span class="st">"maRce10/warbleR"</span>,</span>
<span id="cb1-7"><a href="#cb1-7"></a>    <span class="at">github =</span> <span class="st">"maRce10/ohun"</span>, <span class="st">"caret"</span>, <span class="st">"randomForest"</span>, <span class="st">"DiagrammeR"</span>))</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="fu">warbleR_options</span>(<span class="at">wav.path =</span> <span class="st">"/media/m/Expansion/audios_cin_alcohol_2023"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="read-data" class="level1 unnumbered unlisted">
<h1 class="unnumbered unlisted">Read data</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>anns <span class="ot">&lt;-</span> <span class="fu">imp_raven</span>(<span class="st">"./data/processed/annotations"</span>, <span class="at">warbler.format =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="at">all.data =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3"></a></span>
<span id="cb2-4"><a href="#cb2-4"></a>anns<span class="sc">$</span>subc <span class="ot">&lt;-</span> anns<span class="sc">$</span>subtipos_completo <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb2-5"><a href="#cb2-5"></a></span>
<span id="cb2-6"><a href="#cb2-6"></a>anns <span class="ot">&lt;-</span> anns[<span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>subtipos), ]</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>anns<span class="sc">$</span>subtipos[anns<span class="sc">$</span>subtipos <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">44</span>)] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb2-9"><a href="#cb2-9"></a></span>
<span id="cb2-10"><a href="#cb2-10"></a>anns <span class="ot">&lt;-</span> anns[<span class="fu">order</span>(anns<span class="sc">$</span>sound.files, anns<span class="sc">$</span>start), ]</span>
<span id="cb2-11"><a href="#cb2-11"></a></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="fu">nrow</span>(anns)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 17147</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>anns <span class="ot">&lt;-</span> anns[anns<span class="sc">$</span>start <span class="sc">&lt;</span> anns<span class="sc">$</span>end, ]</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>anns<span class="sc">$</span>subtype.label <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a>anns<span class="sc">$</span>subtype.label[anns<span class="sc">$</span>subtipos <span class="sc">==</span> <span class="dv">22</span>] <span class="ot">&lt;-</span> <span class="st">"22 kHz"</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>anns<span class="sc">$</span>subtype.label[anns<span class="sc">$</span>subtipos <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="st">"flat"</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>anns<span class="sc">$</span>subtype.label[anns<span class="sc">$</span>subtipos <span class="sc">==</span> <span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="st">"trill"</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>anns<span class="sc">$</span>subtype.label[anns<span class="sc">$</span>subtipos <span class="sc">==</span> <span class="dv">6</span>] <span class="ot">&lt;-</span> <span class="st">"complex"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="describe-annotations-single-element-subtypes" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Describe annotations (single element subtypes)</h1>
<ul>
<li>Proportion of calls per subtype</li>
<li>This is the annotation data without any modification</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(anns<span class="sc">$</span>subtype.label)<span class="sc">/</span><span class="fu">nrow</span>(anns), <span class="dv">2</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(anns<span class="sc">$</span>subtype.label))</span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a>count_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Subtype</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22 kHz</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">complex</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">2328</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">681</td>
</tr>
<tr class="even">
<td style="text-align: left;">trill</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">14123</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="data-analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Data analysis</h1>
<div class="cell">
<div class="cell-output-display">
<div>
<div>
<pre class="mermaid mermaid-js">flowchart LR
  A[Annotations] --&gt; C(Measure\nsingle-note\nsubtype\nstructure)
  B[recordings] --&gt; C
  C --&gt; D(Build\ncomposed\nsubtypes)
  C --&gt; E(Classify\nsimple\nsubtypes) 
  D --&gt; F(Classify\ncomposed\nsubtypes)
  F --&gt; G(Evaluate classification)
  E --&gt; G
  
style A fill:#44015466
style B fill:#3E4A894D
style C fill:#26828E4D
style D fill:#31688E4D
style E fill:#6DCD594D
style G fill:#FDE7254D

</pre>
</div>
</div>
</div>
</div>
</section>
<section id="measure-acoustic-structure" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Measure acoustic structure</h1>
<p>Acoustic structure measured as spectrographic/spectrum/envelope features as well as statistical descriptors of Mel frequency cepstral coefficients</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>cs <span class="ot">&lt;-</span> <span class="fu">check_sels</span>(anns, <span class="at">parallel =</span> <span class="dv">1</span>)</span>
<span id="cb6-2"><a href="#cb6-2"></a></span>
<span id="cb6-3"><a href="#cb6-3"></a>sp <span class="ot">&lt;-</span> <span class="fu">spectro_analysis</span>(anns, <span class="at">parallel =</span> <span class="dv">5</span>, <span class="at">ovlp =</span> <span class="dv">70</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a>mfccs <span class="ot">&lt;-</span> <span class="fu">mfcc_stats</span>(anns, <span class="at">parallel =</span> <span class="dv">5</span>, <span class="at">ovlp =</span> <span class="dv">70</span>)</span>
<span id="cb6-5"><a href="#cb6-5"></a></span>
<span id="cb6-6"><a href="#cb6-6"></a>anns_sp <span class="ot">&lt;-</span> <span class="fu">merge</span>(anns, sp)</span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>anns_sp <span class="ot">&lt;-</span> <span class="fu">merge</span>(anns_sp, mfccs)</span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="fu">colnames</span>(anns_sp)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="fu">write.csv</span>(anns_sp, <span class="st">"./data/processed/annotations_and_spectrogram_and_mel_features.csv"</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="multi-element-composed-subtypes" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Multi-element composed subtypes</h1>
<ul>
<li>Define as those in which single elements are within a 5 ms range</li>
</ul>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_and_spectrogram_and_mel_features.csv"</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>anns<span class="sc">$</span>true.end <span class="ot">&lt;-</span> anns<span class="sc">$</span>end</span>
<span id="cb7-4"><a href="#cb7-4"></a></span>
<span id="cb7-5"><a href="#cb7-5"></a>anns<span class="sc">$</span>end <span class="ot">&lt;-</span> anns<span class="sc">$</span>end <span class="sc">+</span> <span class="fl">0.005</span></span>
<span id="cb7-6"><a href="#cb7-6"></a></span>
<span id="cb7-7"><a href="#cb7-7"></a>anns <span class="ot">&lt;-</span> <span class="fu">overlapping_sels</span>(anns)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a>anns<span class="sc">$</span>end <span class="ot">&lt;-</span> anns<span class="sc">$</span>true.end</span>
<span id="cb7-10"><a href="#cb7-10"></a></span>
<span id="cb7-11"><a href="#cb7-11"></a>anns<span class="sc">$</span>true.end <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a><span class="co"># add song label to elements</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>anns<span class="sc">$</span>composed.subtype <span class="ot">&lt;-</span> anns<span class="sc">$</span>ovlp.sels</span>
<span id="cb7-15"><a href="#cb7-15"></a></span>
<span id="cb7-16"><a href="#cb7-16"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(anns))) <span class="cf">if</span> (<span class="fu">is.na</span>(anns<span class="sc">$</span>composed.subtype[i])) anns<span class="sc">$</span>composed.subtype[i] <span class="ot">&lt;-</span> <span class="fu">max</span>(anns<span class="sc">$</span>composed.subtype,</span>
<span id="cb7-17"><a href="#cb7-17"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb7-18"><a href="#cb7-18"></a></span>
<span id="cb7-19"><a href="#cb7-19"></a><span class="fu">write.csv</span>(anns, <span class="st">"./data/processed/annotations_groups_spectrogram_and_mel_features.csv"</span>,</span>
<span id="cb7-20"><a href="#cb7-20"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- light brown box -->
<section id="rules-to-determine-composed-subtypes" class="level2 alert alert-warning" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="rules-to-determine-composed-subtypes"><span class="header-section-number">5.1</span> Rules to determine composed subtypes</h2>
<ul>
<li>If any of the composing subtypes is complex then <strong>composed complex</strong></li>
<li>If it contains 3 or more single subtypes then <strong>composed complex</strong></li>
<li>If ‘flat-trill’ and ‘trill-flat’ then <strong>step flat trill</strong></li>
<li>If it has at least two adjacent trills (‘trill-trill’) and the frequency change is equal or higher than 5 kHz then <strong>step trill</strong></li>
<li>If it has at least two adjacent flats (‘flat-flat’) and the frequency change is equal or higher than 5 kHz then <strong>step flat</strong></li>
</ul>
</section>
<p>&nbsp;</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_groups_spectrogram_and_mel_features.csv"</span>)</span>
<span id="cb8-2"><a href="#cb8-2"></a></span>
<span id="cb8-3"><a href="#cb8-3"></a></span>
<span id="cb8-4"><a href="#cb8-4"></a>composed_anns_list <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">unique</span>(<span class="fu">na.omit</span>(anns<span class="sc">$</span>ovlp.sels)), <span class="cf">function</span>(x) {</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="fu">data.frame</span>(<span class="at">sound.files =</span> anns<span class="sc">$</span>sound.files[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span> x <span class="sc">&amp;</span></span>
<span id="cb8-7"><a href="#cb8-7"></a>        <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)][<span class="dv">1</span>], <span class="at">selec =</span> x, <span class="at">start =</span> <span class="fu">min</span>(anns<span class="sc">$</span>start[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span></span>
<span id="cb8-8"><a href="#cb8-8"></a>        x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)]), <span class="at">end =</span> <span class="fu">max</span>(anns<span class="sc">$</span>end[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>        x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)]), <span class="at">bottom.freq =</span> <span class="fu">min</span>(anns<span class="sc">$</span>bottom.freq[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>        x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)]), <span class="at">top.freq =</span> <span class="fu">max</span>(anns<span class="sc">$</span>top.freq[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>        x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)]), <span class="at">subtypes =</span> <span class="fu">paste</span>(anns<span class="sc">$</span>subtipos[anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>        x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)], <span class="at">collapse =</span> <span class="st">"-"</span>), <span class="at">composed.subtype =</span> x,</span>
<span id="cb8-13"><a href="#cb8-13"></a>        <span class="at">count.subtypes =</span> <span class="fu">sum</span>(anns<span class="sc">$</span>ovlp.sels <span class="sc">==</span> x <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels)))</span>
<span id="cb8-14"><a href="#cb8-14"></a>})</span>
<span id="cb8-15"><a href="#cb8-15"></a></span>
<span id="cb8-16"><a href="#cb8-16"></a>composed_anns <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, composed_anns_list)</span>
<span id="cb8-17"><a href="#cb8-17"></a></span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="fu">unique</span>(composed_anns<span class="sc">$</span>subtypes)</span>
<span id="cb8-19"><a href="#cb8-19"></a></span>
<span id="cb8-20"><a href="#cb8-20"></a></span>
<span id="cb8-21"><a href="#cb8-21"></a><span class="co"># subtypes &lt;- c(1 = 'flat', 4 = 'trill', 6 = 'complejas', 22 =</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="co"># '22 kHz')</span></span>
<span id="cb8-23"><a href="#cb8-23"></a></span>
<span id="cb8-24"><a href="#cb8-24"></a><span class="co"># add labels</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb8-26"><a href="#cb8-26"></a></span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co"># of it contain complex subtype then is complex</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"6"</span>, composed_anns<span class="sc">$</span>subtypes),</span>
<span id="cb8-29"><a href="#cb8-29"></a>    <span class="st">"composed.complex"</span>, composed_anns<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a><span class="co"># of it contain 3 or more elements it is complex</span></span>
<span id="cb8-32"><a href="#cb8-32"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(composed_anns<span class="sc">$</span>count.subtypes <span class="sc">&gt;=</span></span>
<span id="cb8-33"><a href="#cb8-33"></a>    <span class="dv">3</span>, <span class="st">"composed.complex"</span>, composed_anns<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb8-34"><a href="#cb8-34"></a></span>
<span id="cb8-35"><a href="#cb8-35"></a><span class="co"># 1-4 and 4-1 is a 3 (trill flat steps)</span></span>
<span id="cb8-36"><a href="#cb8-36"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"^1-4$|^4-1$"</span>,</span>
<span id="cb8-37"><a href="#cb8-37"></a>    composed_anns<span class="sc">$</span>subtypes), <span class="st">"step.flat.trill"</span>, composed_anns<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb8-38"><a href="#cb8-38"></a></span>
<span id="cb8-39"><a href="#cb8-39"></a><span class="co"># if it has at least two adjacent 4 ('4-4' two trills) and the</span></span>
<span id="cb8-40"><a href="#cb8-40"></a><span class="co"># frequency change is equal or higher than 5 kHz it is a step</span></span>
<span id="cb8-41"><a href="#cb8-41"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(composed_anns)),</span>
<span id="cb8-42"><a href="#cb8-42"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb8-43"><a href="#cb8-43"></a></span>
<span id="cb8-44"><a href="#cb8-44"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"4-4"</span>, composed_anns<span class="sc">$</span>subtypes[x])) <span class="sc">&amp;</span> composed_anns<span class="sc">$</span>count.subtypes[x] <span class="sc">==</span></span>
<span id="cb8-45"><a href="#cb8-45"></a>            <span class="dv">2</span>) {</span>
<span id="cb8-46"><a href="#cb8-46"></a></span>
<span id="cb8-47"><a href="#cb8-47"></a>            peakfs <span class="ot">&lt;-</span> anns<span class="sc">$</span>meanpeakf[anns<span class="sc">$</span>composed.subtype <span class="sc">==</span> composed_anns<span class="sc">$</span>composed.subtype[x]]</span>
<span id="cb8-48"><a href="#cb8-48"></a></span>
<span id="cb8-49"><a href="#cb8-49"></a>            diff_freq <span class="ot">&lt;-</span> <span class="fu">abs</span>(peakfs[<span class="dv">1</span>] <span class="sc">-</span> peakfs[<span class="dv">2</span>])</span>
<span id="cb8-50"><a href="#cb8-50"></a></span>
<span id="cb8-51"><a href="#cb8-51"></a>            out <span class="ot">&lt;-</span> <span class="cf">if</span> (diff_freq <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb8-52"><a href="#cb8-52"></a>                <span class="st">"step.trill"</span> <span class="cf">else</span> <span class="st">"composed.trill"</span></span>
<span id="cb8-53"><a href="#cb8-53"></a>        } <span class="cf">else</span> out <span class="ot">&lt;-</span> composed_anns<span class="sc">$</span>composed.subtype.label[x]</span>
<span id="cb8-54"><a href="#cb8-54"></a></span>
<span id="cb8-55"><a href="#cb8-55"></a>        <span class="fu">return</span>(out)</span>
<span id="cb8-56"><a href="#cb8-56"></a>    })</span>
<span id="cb8-57"><a href="#cb8-57"></a></span>
<span id="cb8-58"><a href="#cb8-58"></a><span class="co"># if it has at least two adjacent 1 ('1-1' two flats) and the</span></span>
<span id="cb8-59"><a href="#cb8-59"></a><span class="co"># frequency change is equal or higher than 5 kHz it is a step</span></span>
<span id="cb8-60"><a href="#cb8-60"></a>composed_anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(composed_anns)),</span>
<span id="cb8-61"><a href="#cb8-61"></a>    <span class="cf">function</span>(x) {</span>
<span id="cb8-62"><a href="#cb8-62"></a></span>
<span id="cb8-63"><a href="#cb8-63"></a>        <span class="cf">if</span> (<span class="fu">sum</span>(<span class="fu">grepl</span>(<span class="st">"1-1"</span>, composed_anns<span class="sc">$</span>subtypes[x])) <span class="sc">&amp;</span> composed_anns<span class="sc">$</span>count.subtypes[x] <span class="sc">==</span></span>
<span id="cb8-64"><a href="#cb8-64"></a>            <span class="dv">2</span>) {</span>
<span id="cb8-65"><a href="#cb8-65"></a></span>
<span id="cb8-66"><a href="#cb8-66"></a>            peakfs <span class="ot">&lt;-</span> anns<span class="sc">$</span>meanpeakf[anns<span class="sc">$</span>composed.subtype <span class="sc">==</span> composed_anns<span class="sc">$</span>composed.subtype[x]]</span>
<span id="cb8-67"><a href="#cb8-67"></a></span>
<span id="cb8-68"><a href="#cb8-68"></a>            diff_freq <span class="ot">&lt;-</span> <span class="fu">abs</span>(peakfs[<span class="dv">1</span>] <span class="sc">-</span> peakfs[<span class="dv">2</span>])</span>
<span id="cb8-69"><a href="#cb8-69"></a></span>
<span id="cb8-70"><a href="#cb8-70"></a>            out <span class="ot">&lt;-</span> <span class="cf">if</span> (diff_freq <span class="sc">&gt;=</span> <span class="dv">5</span>)</span>
<span id="cb8-71"><a href="#cb8-71"></a>                <span class="st">"step.flat"</span> <span class="cf">else</span> <span class="st">"composed.flat"</span></span>
<span id="cb8-72"><a href="#cb8-72"></a>        } <span class="cf">else</span> out <span class="ot">&lt;-</span> composed_anns<span class="sc">$</span>composed.subtype.label[x]</span>
<span id="cb8-73"><a href="#cb8-73"></a></span>
<span id="cb8-74"><a href="#cb8-74"></a>        <span class="fu">return</span>(out)</span>
<span id="cb8-75"><a href="#cb8-75"></a>    })</span>
<span id="cb8-76"><a href="#cb8-76"></a></span>
<span id="cb8-77"><a href="#cb8-77"></a><span class="fu">unique</span>(composed_anns<span class="sc">$</span>subtypes[composed_anns<span class="sc">$</span>count.subtypes <span class="sc">==</span> <span class="dv">2</span> <span class="sc">&amp;</span></span>
<span id="cb8-78"><a href="#cb8-78"></a>    <span class="fu">is.na</span>(composed_anns<span class="sc">$</span>composed.subtype.label)])</span>
<span id="cb8-79"><a href="#cb8-79"></a></span>
<span id="cb8-80"><a href="#cb8-80"></a><span class="fu">round</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>composed.subtype.label)<span class="sc">/</span><span class="fu">nrow</span>(composed_anns),</span>
<span id="cb8-81"><a href="#cb8-81"></a>    <span class="dv">2</span>)</span>
<span id="cb8-82"><a href="#cb8-82"></a></span>
<span id="cb8-83"><a href="#cb8-83"></a>composed_anns<span class="sc">$</span>subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"step"</span>, composed_anns<span class="sc">$</span>composed.subtype.label),</span>
<span id="cb8-84"><a href="#cb8-84"></a>    <span class="st">"step"</span>, composed_anns<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb8-85"><a href="#cb8-85"></a></span>
<span id="cb8-86"><a href="#cb8-86"></a>composed_anns<span class="sc">$</span>subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"complex"</span>, composed_anns<span class="sc">$</span>composed.subtype.label),</span>
<span id="cb8-87"><a href="#cb8-87"></a>    <span class="st">"complex"</span>, composed_anns<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb8-88"><a href="#cb8-88"></a></span>
<span id="cb8-89"><a href="#cb8-89"></a></span>
<span id="cb8-90"><a href="#cb8-90"></a>composed_anns<span class="sc">$</span>subtype.label <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(<span class="st">"composed.trill"</span>, composed_anns<span class="sc">$</span>composed.subtype.label),</span>
<span id="cb8-91"><a href="#cb8-91"></a>    <span class="st">"trill"</span>, composed_anns<span class="sc">$</span>subtype.label)</span>
<span id="cb8-92"><a href="#cb8-92"></a></span>
<span id="cb8-93"><a href="#cb8-93"></a><span class="fu">write.csv</span>(composed_anns, <span class="st">"./data/processed/annotations_composed_subtypes_5ms.csv"</span>,</span>
<span id="cb8-94"><a href="#cb8-94"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-95"><a href="#cb8-95"></a></span>
<span id="cb8-96"><a href="#cb8-96"></a>anns<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"single"</span></span>
<span id="cb8-97"><a href="#cb8-97"></a>anns<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> anns<span class="sc">$</span>subtype.label</span>
<span id="cb8-98"><a href="#cb8-98"></a></span>
<span id="cb8-99"><a href="#cb8-99"></a>composed_anns<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="st">"composed"</span></span>
<span id="cb8-100"><a href="#cb8-100"></a></span>
<span id="cb8-101"><a href="#cb8-101"></a>cols <span class="ot">&lt;-</span> <span class="fu">intersect</span>(<span class="fu">colnames</span>(anns), <span class="fu">colnames</span>(composed_anns))</span>
<span id="cb8-102"><a href="#cb8-102"></a></span>
<span id="cb8-103"><a href="#cb8-103"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">rbind</span>(anns[<span class="fu">is.na</span>(anns<span class="sc">$</span>ovlp.sels), cols], composed_anns[,</span>
<span id="cb8-104"><a href="#cb8-104"></a>    cols])</span>
<span id="cb8-105"><a href="#cb8-105"></a></span>
<span id="cb8-106"><a href="#cb8-106"></a><span class="fu">write.csv</span>(combined_anns, <span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>,</span>
<span id="cb8-107"><a href="#cb8-107"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Summary</h1>
<p>Proportion of calls per subtypes for composed (multi-element) subtypes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>composed_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>composed.subtype.label)<span class="sc">/</span><span class="fu">nrow</span>(composed_anns),</span>
<span id="cb9-4"><a href="#cb9-4"></a>    <span class="dv">2</span>)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb9-10"><a href="#cb9-10"></a></span>
<span id="cb9-11"><a href="#cb9-11"></a>count_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Subtype</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">composed.complex</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">1156</td>
</tr>
<tr class="even">
<td style="text-align: left;">composed.trill</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step.flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">step.flat.trill</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">120</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step.trill</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">1951</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Combination of single element calls on each composed subtype</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>subtypes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">`</span><span class="at">1</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"flat"</span>, <span class="st">`</span><span class="at">4</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"trill"</span>, <span class="st">`</span><span class="at">6</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"complex"</span>, <span class="st">`</span><span class="at">22</span><span class="st">`</span> <span class="ot">=</span> <span class="st">"22 kHz"</span>)</span>
<span id="cb10-2"><a href="#cb10-2"></a></span>
<span id="cb10-3"><a href="#cb10-3"></a>composed_anns<span class="sc">$</span>single.type.combs <span class="ot">&lt;-</span> composed_anns<span class="sc">$</span>subtypes</span>
<span id="cb10-4"><a href="#cb10-4"></a></span>
<span id="cb10-5"><a href="#cb10-5"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(subtypes)) composed_anns<span class="sc">$</span>single.type.combs <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="fu">names</span>(subtypes)[i],</span>
<span id="cb10-6"><a href="#cb10-6"></a>    subtypes[i], composed_anns<span class="sc">$</span>single.type.combs)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>single.type.combs)<span class="sc">/</span><span class="fu">nrow</span>(composed_anns),</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="dv">2</span>)</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb10-12"><a href="#cb10-12"></a></span>
<span id="cb10-13"><a href="#cb10-13"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>single.type.combs))</span>
<span id="cb10-14"><a href="#cb10-14"></a></span>
<span id="cb10-15"><a href="#cb10-15"></a>count_types<span class="sc">$</span>comp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Var1, <span class="cf">function</span>(x) composed_anns<span class="sc">$</span>composed.subtype.label[composed_anns<span class="sc">$</span>single.type.combs <span class="sc">==</span></span>
<span id="cb10-16"><a href="#cb10-16"></a>    x][<span class="dv">1</span>])</span>
<span id="cb10-17"><a href="#cb10-17"></a></span>
<span id="cb10-18"><a href="#cb10-18"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Single subtype combination"</span>, <span class="st">"Proportion"</span>,</span>
<span id="cb10-19"><a href="#cb10-19"></a>    <span class="st">"Count"</span>, <span class="st">"Composed subtype"</span>)</span>
<span id="cb10-20"><a href="#cb10-20"></a></span>
<span id="cb10-21"><a href="#cb10-21"></a>count_types <span class="ot">&lt;-</span> count_types[<span class="fu">order</span>(count_types<span class="sc">$</span><span class="st">`</span><span class="at">Composed subtype</span><span class="st">`</span>),</span>
<span id="cb10-22"><a href="#cb10-22"></a>    ]</span>
<span id="cb10-23"><a href="#cb10-23"></a></span>
<span id="cb10-24"><a href="#cb10-24"></a>count_types[, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 4%">
<col style="width: 23%">
<col style="width: 49%">
<col style="width: 15%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">Composed subtype</th>
<th style="text-align: left;">Single subtype combination</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Count</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-complex</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">23</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-complex-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-trill</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">91</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-trill-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">6</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">complex-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">9</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-flat-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-flat-trill-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">11</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-flat-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-trill-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">14</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-trill-flat-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-trill-flat-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">flat-trill-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">18</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-complex</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">744</td>
</tr>
<tr class="odd">
<td style="text-align: left;">19</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-complex-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">20</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-complex-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">21</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-complex-trill-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">22</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-complex-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">24</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">25</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">26</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-flat-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: left;">27</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-trill</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">28</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-trill-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">29</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">30</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-flat-trill-trill-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">32</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-complex</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">29</td>
</tr>
<tr class="odd">
<td style="text-align: left;">33</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-complex-complex</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">34</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-complex-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">35</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">36</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-flat-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">37</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-trill</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">134</td>
</tr>
<tr class="even">
<td style="text-align: left;">38</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-trill-complex-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">39</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">40</td>
<td style="text-align: left;">composed.complex</td>
<td style="text-align: left;">trill-trill-trill-trill-trill-trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">8</td>
<td style="text-align: left;">step.flat</td>
<td style="text-align: left;">flat-flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: left;">step.flat.trill</td>
<td style="text-align: left;">flat-trill</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">56</td>
</tr>
<tr class="odd">
<td style="text-align: left;">23</td>
<td style="text-align: left;">step.flat.trill</td>
<td style="text-align: left;">trill-flat</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">64</td>
</tr>
<tr class="even">
<td style="text-align: left;">31</td>
<td style="text-align: left;">step.trill</td>
<td style="text-align: left;">trill-trill</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">1979</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Proportion of calls per subtypes for both single and composed (multi-element) subtypes</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>subtype.label)<span class="sc">/</span><span class="fu">nrow</span>(combined_anns),</span>
<span id="cb11-4"><a href="#cb11-4"></a>    <span class="dv">2</span>)</span>
<span id="cb11-5"><a href="#cb11-5"></a></span>
<span id="cb11-6"><a href="#cb11-6"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb11-7"><a href="#cb11-7"></a></span>
<span id="cb11-8"><a href="#cb11-8"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>subtype.label))</span>
<span id="cb11-9"><a href="#cb11-9"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb11-10"><a href="#cb11-10"></a></span>
<span id="cb11-11"><a href="#cb11-11"></a>count_types<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Subtype, <span class="cf">function</span>(x) <span class="fu">unique</span>(combined_anns<span class="sc">$</span>type[combined_anns<span class="sc">$</span>subtype.label <span class="sc">==</span></span>
<span id="cb11-12"><a href="#cb11-12"></a>    x]))</span>
<span id="cb11-13"><a href="#cb11-13"></a></span>
<span id="cb11-14"><a href="#cb11-14"></a>count_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Subtype</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Count</th>
<th style="text-align: left;">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22 kHz</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">single</td>
</tr>
<tr class="even">
<td style="text-align: left;">complex</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">2502</td>
<td style="text-align: left;">single , composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">433</td>
<td style="text-align: left;">single</td>
</tr>
<tr class="even">
<td style="text-align: left;">step.flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step.flat.trill</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">120</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="even">
<td style="text-align: left;">step.trill</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">1951</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trill</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">8505</td>
<td style="text-align: left;">single , composed</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Proportion of calls per subtypes for both single and composed by type (single vs composed)</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a></span>
<span id="cb12-3"><a href="#cb12-3"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>composed.subtype.label)<span class="sc">/</span><span class="fu">nrow</span>(combined_anns),</span>
<span id="cb12-4"><a href="#cb12-4"></a>    <span class="dv">2</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb12-9"><a href="#cb12-9"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a>count_types<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Subtype, <span class="cf">function</span>(x) <span class="fu">unique</span>(combined_anns<span class="sc">$</span>type[combined_anns<span class="sc">$</span>composed.subtype.label <span class="sc">==</span></span>
<span id="cb12-12"><a href="#cb12-12"></a>    x]))</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a>count_types</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="kable-table">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Subtype</th>
<th style="text-align: right;">Proportion</th>
<th style="text-align: right;">Count</th>
<th style="text-align: left;">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">22 kHz</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">single</td>
</tr>
<tr class="even">
<td style="text-align: left;">complex</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">1346</td>
<td style="text-align: left;">single</td>
</tr>
<tr class="odd">
<td style="text-align: left;">composed.complex</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">1156</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="even">
<td style="text-align: left;">composed.trill</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">28</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flat</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">433</td>
<td style="text-align: left;">single</td>
</tr>
<tr class="even">
<td style="text-align: left;">step.flat</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">13</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step.flat.trill</td>
<td style="text-align: right;">0.01</td>
<td style="text-align: right;">120</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="even">
<td style="text-align: left;">step.trill</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">1951</td>
<td style="text-align: left;">composed</td>
</tr>
<tr class="odd">
<td style="text-align: left;">trill</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">8477</td>
<td style="text-align: left;">single</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="create-spectrograms" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Create spectrograms</h1>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>types <span class="ot">&lt;-</span> <span class="fu">unique</span>(combined_anns<span class="sc">$</span>subtype.label)</span>
<span id="cb13-2"><a href="#cb13-2"></a></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="cf">for</span> (i <span class="cf">in</span> types[<span class="dv">7</span><span class="sc">:</span><span class="dv">1</span>]) {</span>
<span id="cb13-4"><a href="#cb13-4"></a>    <span class="fu">print</span>(i)</span>
<span id="cb13-5"><a href="#cb13-5"></a>    X <span class="ot">&lt;-</span> combined_anns[combined_anns<span class="sc">$</span>subtype.label <span class="sc">==</span> i, ]</span>
<span id="cb13-6"><a href="#cb13-6"></a></span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="co"># subset</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(X) <span class="sc">&gt;</span> <span class="dv">120</span>)</span>
<span id="cb13-10"><a href="#cb13-10"></a>        X <span class="ot">&lt;-</span> X[<span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(X)), <span class="dv">120</span>), ]</span>
<span id="cb13-11"><a href="#cb13-11"></a></span>
<span id="cb13-12"><a href="#cb13-12"></a>    nrw <span class="ot">&lt;-</span> ncl <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>    n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(X)</span>
<span id="cb13-14"><a href="#cb13-14"></a>    <span class="cf">if</span> (n <span class="sc">&gt;</span> <span class="dv">4</span>) {</span>
<span id="cb13-15"><a href="#cb13-15"></a>        nrw <span class="ot">&lt;-</span> ncl <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(<span class="fu">sqrt</span>(n))</span>
<span id="cb13-16"><a href="#cb13-16"></a>        <span class="cf">if</span> (((nrw <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> ncl) <span class="sc">&gt;=</span> n)</span>
<span id="cb13-17"><a href="#cb13-17"></a>            nrw <span class="ot">&lt;-</span> nrw <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>    }</span>
<span id="cb13-19"><a href="#cb13-19"></a></span>
<span id="cb13-20"><a href="#cb13-20"></a>    <span class="co"># print catalog</span></span>
<span id="cb13-21"><a href="#cb13-21"></a>    <span class="fu">catalog</span>(<span class="at">X =</span> X, <span class="at">nrow =</span> nrw, <span class="at">ncol =</span> ncl, <span class="at">same.time.scale =</span> T, <span class="at">mar =</span> <span class="fl">0.001</span>,</span>
<span id="cb13-22"><a href="#cb13-22"></a>        <span class="at">res =</span> <span class="dv">100</span>, <span class="at">pb =</span> <span class="cn">FALSE</span>, <span class="at">spec.mar =</span> <span class="fl">0.001</span>, <span class="at">max.group.cols =</span> <span class="dv">5</span>,</span>
<span id="cb13-23"><a href="#cb13-23"></a>        <span class="at">title =</span> i, <span class="at">ovlp =</span> <span class="dv">50</span>, <span class="at">wl =</span> <span class="dv">512</span>, <span class="at">width =</span> <span class="dv">15</span>, <span class="at">height =</span> <span class="dv">9</span>, <span class="at">hatching =</span> <span class="dv">0</span>,</span>
<span id="cb13-24"><a href="#cb13-24"></a>        <span class="at">cex =</span> <span class="fl">1.3</span>, <span class="at">fast.spec =</span> <span class="cn">FALSE</span>, <span class="at">pal =</span> viridis, <span class="at">img.prefix =</span> i,</span>
<span id="cb13-25"><a href="#cb13-25"></a>        <span class="at">rm.axes =</span> <span class="cn">TRUE</span>, <span class="at">flim =</span> <span class="fu">c</span>(<span class="fu">min</span>(X<span class="sc">$</span>bottom.freq), <span class="fu">max</span>(X<span class="sc">$</span>top.freq)) <span class="sc">+</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>            <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="at">alpha =</span> <span class="fl">0.25</span>, <span class="at">collevels =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">120</span>, <span class="dv">0</span>, <span class="dv">5</span>), <span class="at">box =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-27"><a href="#cb13-27"></a>        <span class="at">lab.mar =</span> <span class="fl">1e-05</span>)</span>
<span id="cb13-28"><a href="#cb13-28"></a></span>
<span id="cb13-29"><a href="#cb13-29"></a>    <span class="fu">move_images</span>(<span class="at">from =</span> .Options<span class="sc">$</span>warbleR<span class="sc">$</span>path, <span class="at">to =</span> <span class="st">"./output/catalogs"</span>,</span>
<span id="cb13-30"><a href="#cb13-30"></a>        <span class="at">overwrite =</span> <span class="cn">TRUE</span>, <span class="at">cut =</span> <span class="cn">TRUE</span>, <span class="at">pb =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-31"><a href="#cb13-31"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="single-element-subtypes" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="single-element-subtypes"><span class="header-section-number">7.1</span> Single element subtypes</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="flat-Catalog_p1.jpeg" class="img-fluid figure-img"></p>
<figcaption>Flat</figcaption>
</figure>
</div>
<p><img src="trill-Catalog_p1.jpeg" class="img-fluid" alt="Trill"> <img src="complex-Catalog_p1.jpeg" class="img-fluid" alt="Complex"></p>
</section>
<section id="composed-subtypes" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="composed-subtypes"><span class="header-section-number">7.2</span> Composed subtypes</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="step.flat-Catalog_p1.jpeg" class="img-fluid figure-img"></p>
<figcaption>Step flat</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="step.trill-Catalog_p1.jpeg" class="img-fluid figure-img"></p>
<figcaption>Step trill</figcaption>
</figure>
</div>
<p><img src="step.flat.trill-Catalog_p1.jpeg" class="img-fluid" alt="Step flat trill"> # Random forest classification</p>
<p>Models trained for 100 iterations on 75% of the data and tested on the remaining 25%.</p>
</section>
<section id="on-single-element-subtypes" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="on-single-element-subtypes"><span class="header-section-number">7.3</span> On single element subtypes</h2>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>elm_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_groups_spectrogram_and_mel_features.csv"</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a></span>
<span id="cb14-3"><a href="#cb14-3"></a>elm_anns <span class="ot">&lt;-</span> elm_anns[elm_anns<span class="sc">$</span>subtype.label <span class="sc">!=</span> <span class="st">"22"</span>, ]</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="co"># remove collinear</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>target_features <span class="ot">&lt;-</span> <span class="fu">names</span>(elm_anns)[<span class="sc">!</span><span class="fu">names</span>(elm_anns) <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>, <span class="st">"View"</span>, <span class="st">"Channel"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"bottom.freq"</span>, <span class="st">"top.freq"</span>, <span class="st">"Delta.Time..s."</span>, <span class="st">"Begin.File"</span>, <span class="st">"subtipos"</span>, <span class="st">"selec.file"</span>, <span class="st">"true.end"</span>, <span class="st">"ovlp.sels"</span>, <span class="st">"composed.subtype"</span>, <span class="st">"subtype.label"</span>, <span class="fu">names</span>(elm_anns)[<span class="fu">sapply</span>(elm_anns, anyNA)])]</span>
<span id="cb14-8"><a href="#cb14-8"></a></span>
<span id="cb14-9"><a href="#cb14-9"></a>cormat <span class="ot">&lt;-</span> <span class="fu">cor</span>(elm_anns[, target_features], <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb14-10"><a href="#cb14-10"></a>hc <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(cormat, <span class="at">cutoff=</span> <span class="fl">0.9</span>) <span class="co"># putt any value as a "cutoff" </span></span>
<span id="cb14-11"><a href="#cb14-11"></a>hc <span class="ot">&lt;-</span> <span class="fu">sort</span>(hc)</span>
<span id="cb14-12"><a href="#cb14-12"></a></span>
<span id="cb14-13"><a href="#cb14-13"></a>target_features <span class="ot">&lt;-</span> target_features[hc]</span>
<span id="cb14-14"><a href="#cb14-14"></a></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co"># Create data subsets</span></span>
<span id="cb14-16"><a href="#cb14-16"></a>partition <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(</span>
<span id="cb14-17"><a href="#cb14-17"></a>    <span class="at">y =</span> elm_anns<span class="sc">$</span>subtype.label,</span>
<span id="cb14-18"><a href="#cb14-18"></a>    <span class="at">times =</span> <span class="dv">1</span>,</span>
<span id="cb14-19"><a href="#cb14-19"></a>    <span class="at">p =</span> <span class="fl">0.75</span>,</span>
<span id="cb14-20"><a href="#cb14-20"></a>    <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb14-21"><a href="#cb14-21"></a>)</span>
<span id="cb14-22"><a href="#cb14-22"></a></span>
<span id="cb14-23"><a href="#cb14-23"></a></span>
<span id="cb14-24"><a href="#cb14-24"></a></span>
<span id="cb14-25"><a href="#cb14-25"></a>elm_anns<span class="sc">$</span>subtype.label <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(elm_anns<span class="sc">$</span>subtype.label)</span>
<span id="cb14-26"><a href="#cb14-26"></a></span>
<span id="cb14-27"><a href="#cb14-27"></a>trainset <span class="ot">&lt;-</span> elm_anns[partition, <span class="fu">c</span>(target_features, <span class="st">"subtype.label"</span>)]</span>
<span id="cb14-28"><a href="#cb14-28"></a>testset <span class="ot">&lt;-</span> elm_anns[<span class="sc">-</span>partition, <span class="fu">c</span>(target_features, <span class="st">"subtype.label"</span>)]</span>
<span id="cb14-29"><a href="#cb14-29"></a></span>
<span id="cb14-30"><a href="#cb14-30"></a>trcontrol <span class="ot">&lt;-</span></span>
<span id="cb14-31"><a href="#cb14-31"></a>    <span class="fu">trainControl</span>(</span>
<span id="cb14-32"><a href="#cb14-32"></a>        <span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb14-33"><a href="#cb14-33"></a>        <span class="at">number =</span> <span class="dv">100</span>,</span>
<span id="cb14-34"><a href="#cb14-34"></a>        <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb14-35"><a href="#cb14-35"></a>        <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-36"><a href="#cb14-36"></a>        <span class="at">sampling =</span> <span class="st">"down"</span>,</span>
<span id="cb14-37"><a href="#cb14-37"></a>        <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb14-38"><a href="#cb14-38"></a>        <span class="at">returnResamp =</span> <span class="st">"all"</span></span>
<span id="cb14-39"><a href="#cb14-39"></a>    )</span>
<span id="cb14-40"><a href="#cb14-40"></a></span>
<span id="cb14-41"><a href="#cb14-41"></a>pred_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb14-42"><a href="#cb14-42"></a>    subtype.label <span class="sc">~</span> .,</span>
<span id="cb14-43"><a href="#cb14-43"></a>    <span class="at">data =</span> trainset,</span>
<span id="cb14-44"><a href="#cb14-44"></a>    <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb14-45"><a href="#cb14-45"></a>    <span class="at">trControl =</span> trcontrol,</span>
<span id="cb14-46"><a href="#cb14-46"></a>    <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb14-47"><a href="#cb14-47"></a>    <span class="at">preProcess =</span> <span class="st">"scale"</span></span>
<span id="cb14-48"><a href="#cb14-48"></a>)</span>
<span id="cb14-49"><a href="#cb14-49"></a></span>
<span id="cb14-50"><a href="#cb14-50"></a><span class="fu">ggplot</span>(pred_model) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb14-51"><a href="#cb14-51"></a></span>
<span id="cb14-52"><a href="#cb14-52"></a><span class="co"># save confusion matrix</span></span>
<span id="cb14-53"><a href="#cb14-53"></a>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb14-54"><a href="#cb14-54"></a>    <span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(pred_model, testset), testset<span class="sc">$</span>subtype.label)</span>
<span id="cb14-55"><a href="#cb14-55"></a></span>
<span id="cb14-56"><a href="#cb14-56"></a>conf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_mat<span class="sc">$</span>table)</span>
<span id="cb14-57"><a href="#cb14-57"></a></span>
<span id="cb14-58"><a href="#cb14-58"></a>conf_df<span class="sc">$</span>total <span class="ot">&lt;-</span></span>
<span id="cb14-59"><a href="#cb14-59"></a>    <span class="fu">sapply</span>(conf_df<span class="sc">$</span>Reference, <span class="cf">function</span>(x)</span>
<span id="cb14-60"><a href="#cb14-60"></a>        <span class="fu">sum</span>(testset<span class="sc">$</span>subtype.label <span class="sc">==</span></span>
<span id="cb14-61"><a href="#cb14-61"></a>                x))</span>
<span id="cb14-62"><a href="#cb14-62"></a></span>
<span id="cb14-63"><a href="#cb14-63"></a>conf_df<span class="sc">$</span>proportion <span class="ot">&lt;-</span> conf_df<span class="sc">$</span>Freq <span class="sc">/</span> conf_df<span class="sc">$</span>total</span>
<span id="cb14-64"><a href="#cb14-64"></a></span>
<span id="cb14-65"><a href="#cb14-65"></a><span class="co"># fit model on complete data set</span></span>
<span id="cb14-66"><a href="#cb14-66"></a>best_rf_model <span class="ot">&lt;-</span> pred_model<span class="sc">$</span>finalModel</span>
<span id="cb14-67"><a href="#cb14-67"></a></span>
<span id="cb14-68"><a href="#cb14-68"></a><span class="co"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb14-69"><a href="#cb14-69"></a><span class="co">#   subtype.label ~ .,</span></span>
<span id="cb14-70"><a href="#cb14-70"></a><span class="co">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb14-71"><a href="#cb14-71"></a><span class="co">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb14-72"><a href="#cb14-72"></a><span class="co">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb14-73"><a href="#cb14-73"></a><span class="co">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb14-74"><a href="#cb14-74"></a><span class="co">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb14-75"><a href="#cb14-75"></a><span class="co">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb14-76"><a href="#cb14-76"></a><span class="co"># )</span></span>
<span id="cb14-77"><a href="#cb14-77"></a></span>
<span id="cb14-78"><a href="#cb14-78"></a>rf_model_results <span class="ot">&lt;-</span></span>
<span id="cb14-79"><a href="#cb14-79"></a>    <span class="fu">list</span>(</span>
<span id="cb14-80"><a href="#cb14-80"></a>        <span class="at">pred_model_bb =</span> pred_model,</span>
<span id="cb14-81"><a href="#cb14-81"></a>        <span class="at">conf_mat_bb =</span> conf_mat,</span>
<span id="cb14-82"><a href="#cb14-82"></a>        <span class="at">confusion_df_bb =</span> conf_df,</span>
<span id="cb14-83"><a href="#cb14-83"></a>        <span class="at">testset_bb =</span> testset</span>
<span id="cb14-84"><a href="#cb14-84"></a>        <span class="co">#all_rf_model = all_rf_model</span></span>
<span id="cb14-85"><a href="#cb14-85"></a>    )</span>
<span id="cb14-86"><a href="#cb14-86"></a></span>
<span id="cb14-87"><a href="#cb14-87"></a></span>
<span id="cb14-88"><a href="#cb14-88"></a><span class="fu">saveRDS</span>(</span>
<span id="cb14-89"><a href="#cb14-89"></a>    rf_model_results,</span>
<span id="cb14-90"><a href="#cb14-90"></a>    <span class="st">"./data/processed/random_forest_model_results.RDS"</span></span>
<span id="cb14-91"><a href="#cb14-91"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="checking-performance-on-test-data" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="checking-performance-on-test-data"><span class="header-section-number">7.3.1</span> Checking performance on test data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>rf_model_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/processed/random_forest_model_results.RDS"</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="co"># print confusion matrix results</span></span>
<span id="cb15-5"><a href="#cb15-5"></a>rf_model_results<span class="sc">$</span>conf_mat_bb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction complex flat trill
   complex     550    0   357
   flat          2  138   604
   trill        30   32  2569

Overall Statistics
                                        
               Accuracy : 0.761         
                 95% CI : (0.748, 0.773)
    No Information Rate : 0.824         
    P-Value [Acc &gt; NIR] : 1             
                                        
                  Kappa : 0.477         
                                        
 Mcnemar's Test P-Value : &lt;2e-16        

Statistics by Class:

                     Class: complex Class: flat Class: trill
Sensitivity                   0.945      0.8118        0.728
Specificity                   0.904      0.8526        0.918
Pos Pred Value                0.606      0.1855        0.976
Neg Pred Value                0.991      0.9910        0.418
Prevalence                    0.136      0.0397        0.824
Detection Rate                0.128      0.0322        0.600
Detection Prevalence          0.212      0.1738        0.614
Balanced Accuracy             0.924      0.8322        0.823</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>confusion_df <span class="ot">&lt;-</span> rf_model_results<span class="sc">$</span>confusion_df_bb</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="fu">ggplot</span>(confusion_df, <span class="fu">aes</span>(<span class="at">x =</span> Reference, <span class="at">y =</span> Prediction, <span class="at">fill =</span> proportion)) <span class="sc">+</span></span>
<span id="cb17-4"><a href="#cb17-4"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="fu">coord_equal</span>() <span class="sc">+</span> <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>,</span>
<span id="cb17-5"><a href="#cb17-5"></a>    <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(proportion, <span class="dv">2</span>)),</span>
<span id="cb17-6"><a href="#cb17-6"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed"</span>,</span>
<span id="cb17-7"><a href="#cb17-7"></a>    <span class="at">y =</span> <span class="st">"Predicted"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb17-8"><a href="#cb17-8"></a>    <span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>, <span class="at">hjust =</span> <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-539a35d47e664c97a50115a146a7f1bd-1" class="quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div>
<img src="checking_annotations_files/figure-html/unnamed-chunk-14-1.png" id="fig-539a35d47e664c97a50115a146a7f1bd-1" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="on-composed-multi-element-subtypes" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="on-composed-multi-element-subtypes"><span class="header-section-number">7.4</span> On composed (multi-element) subtypes</h2>
<p>Summarize structure at the multi-element subtype level</p>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>elm_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_groups_spectrogram_and_mel_features.csv"</span>)</span>
<span id="cb18-2"><a href="#cb18-2"></a></span>
<span id="cb18-3"><a href="#cb18-3"></a>mean_colms <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"duration"</span>, <span class="st">"meanfreq"</span>, <span class="st">"sd"</span>, <span class="st">"freq.median"</span>, <span class="st">"freq.Q25"</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="st">"freq.Q75"</span>, <span class="st">"freq.IQR"</span>, <span class="st">"time.median"</span>, <span class="st">"time.Q25"</span>, <span class="st">"time.Q75"</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="st">"time.IQR"</span>, <span class="st">"skew"</span>, <span class="st">"kurt"</span>, <span class="st">"sp.ent"</span>, <span class="st">"time.ent"</span>, <span class="st">"entropy"</span>, <span class="st">"sfm"</span>,</span>
<span id="cb18-6"><a href="#cb18-6"></a>    <span class="st">"meandom"</span>, <span class="st">"mindom"</span>, <span class="st">"maxdom"</span>, <span class="st">"dfrange"</span>, <span class="st">"modindx"</span>, <span class="st">"startdom"</span>,</span>
<span id="cb18-7"><a href="#cb18-7"></a>    <span class="st">"enddom"</span>, <span class="st">"dfslope"</span>, <span class="st">"meanpeakf"</span>, <span class="st">"min.cc1"</span>, <span class="st">"min.cc2"</span>, <span class="st">"min.cc3"</span>,</span>
<span id="cb18-8"><a href="#cb18-8"></a>    <span class="st">"min.cc4"</span>, <span class="st">"min.cc5"</span>, <span class="st">"min.cc6"</span>, <span class="st">"min.cc7"</span>, <span class="st">"min.cc8"</span>, <span class="st">"min.cc9"</span>,</span>
<span id="cb18-9"><a href="#cb18-9"></a>    <span class="st">"min.cc10"</span>, <span class="st">"min.cc11"</span>, <span class="st">"min.cc12"</span>, <span class="st">"min.cc13"</span>, <span class="st">"min.cc14"</span>, <span class="st">"min.cc15"</span>,</span>
<span id="cb18-10"><a href="#cb18-10"></a>    <span class="st">"min.cc16"</span>, <span class="st">"min.cc17"</span>, <span class="st">"min.cc18"</span>, <span class="st">"min.cc19"</span>, <span class="st">"min.cc20"</span>, <span class="st">"min.cc21"</span>,</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="st">"min.cc22"</span>, <span class="st">"min.cc23"</span>, <span class="st">"min.cc24"</span>, <span class="st">"min.cc25"</span>, <span class="st">"max.cc1"</span>, <span class="st">"max.cc2"</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="st">"max.cc3"</span>, <span class="st">"max.cc4"</span>, <span class="st">"max.cc5"</span>, <span class="st">"max.cc6"</span>, <span class="st">"max.cc7"</span>, <span class="st">"max.cc8"</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="st">"max.cc9"</span>, <span class="st">"max.cc10"</span>, <span class="st">"max.cc11"</span>, <span class="st">"max.cc12"</span>, <span class="st">"max.cc13"</span>, <span class="st">"max.cc14"</span>,</span>
<span id="cb18-14"><a href="#cb18-14"></a>    <span class="st">"max.cc15"</span>, <span class="st">"max.cc16"</span>, <span class="st">"max.cc17"</span>, <span class="st">"max.cc18"</span>, <span class="st">"max.cc19"</span>, <span class="st">"max.cc20"</span>,</span>
<span id="cb18-15"><a href="#cb18-15"></a>    <span class="st">"max.cc21"</span>, <span class="st">"max.cc22"</span>, <span class="st">"max.cc23"</span>, <span class="st">"max.cc24"</span>, <span class="st">"max.cc25"</span>, <span class="st">"median.cc1"</span>,</span>
<span id="cb18-16"><a href="#cb18-16"></a>    <span class="st">"median.cc2"</span>, <span class="st">"median.cc3"</span>, <span class="st">"median.cc4"</span>, <span class="st">"median.cc5"</span>, <span class="st">"median.cc6"</span>,</span>
<span id="cb18-17"><a href="#cb18-17"></a>    <span class="st">"median.cc7"</span>, <span class="st">"median.cc8"</span>, <span class="st">"median.cc9"</span>, <span class="st">"median.cc10"</span>, <span class="st">"median.cc11"</span>,</span>
<span id="cb18-18"><a href="#cb18-18"></a>    <span class="st">"median.cc12"</span>, <span class="st">"median.cc13"</span>, <span class="st">"median.cc14"</span>, <span class="st">"median.cc15"</span>, <span class="st">"median.cc16"</span>,</span>
<span id="cb18-19"><a href="#cb18-19"></a>    <span class="st">"median.cc17"</span>, <span class="st">"median.cc18"</span>, <span class="st">"median.cc19"</span>, <span class="st">"median.cc20"</span>, <span class="st">"median.cc21"</span>,</span>
<span id="cb18-20"><a href="#cb18-20"></a>    <span class="st">"median.cc22"</span>, <span class="st">"median.cc23"</span>, <span class="st">"median.cc24"</span>, <span class="st">"median.cc25"</span>, <span class="st">"mean.cc1"</span>,</span>
<span id="cb18-21"><a href="#cb18-21"></a>    <span class="st">"mean.cc2"</span>, <span class="st">"mean.cc3"</span>, <span class="st">"mean.cc4"</span>, <span class="st">"mean.cc5"</span>, <span class="st">"mean.cc6"</span>, <span class="st">"mean.cc7"</span>,</span>
<span id="cb18-22"><a href="#cb18-22"></a>    <span class="st">"mean.cc8"</span>, <span class="st">"mean.cc9"</span>, <span class="st">"mean.cc10"</span>, <span class="st">"mean.cc11"</span>, <span class="st">"mean.cc12"</span>,</span>
<span id="cb18-23"><a href="#cb18-23"></a>    <span class="st">"mean.cc13"</span>, <span class="st">"mean.cc14"</span>, <span class="st">"mean.cc15"</span>, <span class="st">"mean.cc16"</span>, <span class="st">"mean.cc17"</span>,</span>
<span id="cb18-24"><a href="#cb18-24"></a>    <span class="st">"mean.cc18"</span>, <span class="st">"mean.cc19"</span>, <span class="st">"mean.cc20"</span>, <span class="st">"mean.cc21"</span>, <span class="st">"mean.cc22"</span>,</span>
<span id="cb18-25"><a href="#cb18-25"></a>    <span class="st">"mean.cc23"</span>, <span class="st">"mean.cc24"</span>, <span class="st">"mean.cc25"</span>, <span class="st">"var.cc1"</span>, <span class="st">"var.cc2"</span>, <span class="st">"var.cc3"</span>,</span>
<span id="cb18-26"><a href="#cb18-26"></a>    <span class="st">"var.cc4"</span>, <span class="st">"var.cc5"</span>, <span class="st">"var.cc6"</span>, <span class="st">"var.cc7"</span>, <span class="st">"var.cc8"</span>, <span class="st">"var.cc9"</span>,</span>
<span id="cb18-27"><a href="#cb18-27"></a>    <span class="st">"var.cc10"</span>, <span class="st">"var.cc11"</span>, <span class="st">"var.cc12"</span>, <span class="st">"var.cc13"</span>, <span class="st">"var.cc14"</span>, <span class="st">"var.cc15"</span>,</span>
<span id="cb18-28"><a href="#cb18-28"></a>    <span class="st">"var.cc16"</span>, <span class="st">"var.cc17"</span>, <span class="st">"var.cc18"</span>, <span class="st">"var.cc19"</span>, <span class="st">"var.cc20"</span>, <span class="st">"var.cc21"</span>,</span>
<span id="cb18-29"><a href="#cb18-29"></a>    <span class="st">"var.cc22"</span>, <span class="st">"var.cc23"</span>, <span class="st">"var.cc24"</span>, <span class="st">"var.cc25"</span>, <span class="st">"skew.cc1"</span>, <span class="st">"skew.cc2"</span>,</span>
<span id="cb18-30"><a href="#cb18-30"></a>    <span class="st">"skew.cc3"</span>, <span class="st">"skew.cc4"</span>, <span class="st">"skew.cc5"</span>, <span class="st">"skew.cc6"</span>, <span class="st">"skew.cc7"</span>, <span class="st">"skew.cc8"</span>,</span>
<span id="cb18-31"><a href="#cb18-31"></a>    <span class="st">"skew.cc9"</span>, <span class="st">"skew.cc10"</span>, <span class="st">"skew.cc11"</span>, <span class="st">"skew.cc12"</span>, <span class="st">"skew.cc13"</span>,</span>
<span id="cb18-32"><a href="#cb18-32"></a>    <span class="st">"skew.cc14"</span>, <span class="st">"skew.cc15"</span>, <span class="st">"skew.cc16"</span>, <span class="st">"skew.cc17"</span>, <span class="st">"skew.cc18"</span>,</span>
<span id="cb18-33"><a href="#cb18-33"></a>    <span class="st">"skew.cc19"</span>, <span class="st">"skew.cc20"</span>, <span class="st">"skew.cc21"</span>, <span class="st">"skew.cc22"</span>, <span class="st">"skew.cc23"</span>,</span>
<span id="cb18-34"><a href="#cb18-34"></a>    <span class="st">"skew.cc24"</span>, <span class="st">"skew.cc25"</span>, <span class="st">"kurt.cc1"</span>, <span class="st">"kurt.cc2"</span>, <span class="st">"kurt.cc3"</span>,</span>
<span id="cb18-35"><a href="#cb18-35"></a>    <span class="st">"kurt.cc4"</span>, <span class="st">"kurt.cc5"</span>, <span class="st">"kurt.cc6"</span>, <span class="st">"kurt.cc7"</span>, <span class="st">"kurt.cc8"</span>, <span class="st">"kurt.cc9"</span>,</span>
<span id="cb18-36"><a href="#cb18-36"></a>    <span class="st">"kurt.cc10"</span>, <span class="st">"kurt.cc11"</span>, <span class="st">"kurt.cc12"</span>, <span class="st">"kurt.cc13"</span>, <span class="st">"kurt.cc14"</span>,</span>
<span id="cb18-37"><a href="#cb18-37"></a>    <span class="st">"kurt.cc15"</span>, <span class="st">"kurt.cc16"</span>, <span class="st">"kurt.cc17"</span>, <span class="st">"kurt.cc18"</span>, <span class="st">"kurt.cc19"</span>,</span>
<span id="cb18-38"><a href="#cb18-38"></a>    <span class="st">"kurt.cc20"</span>, <span class="st">"kurt.cc21"</span>, <span class="st">"kurt.cc22"</span>, <span class="st">"kurt.cc23"</span>, <span class="st">"kurt.cc24"</span>,</span>
<span id="cb18-39"><a href="#cb18-39"></a>    <span class="st">"kurt.cc25"</span>, <span class="st">"mean.d1.cc"</span>, <span class="st">"var.d1.cc"</span>, <span class="st">"mean.d2.cc"</span>, <span class="st">"var.d2.cc"</span>)</span>
<span id="cb18-40"><a href="#cb18-40"></a></span>
<span id="cb18-41"><a href="#cb18-41"></a>composed_param <span class="ot">&lt;-</span> <span class="fu">song_param</span>(<span class="at">X =</span> elm_anns, <span class="at">song_colm =</span> <span class="st">"composed.subtype"</span>,</span>
<span id="cb18-42"><a href="#cb18-42"></a>    <span class="at">mean_colm =</span> mean_colms)</span>
<span id="cb18-43"><a href="#cb18-43"></a></span>
<span id="cb18-44"><a href="#cb18-44"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb18-45"><a href="#cb18-45"></a></span>
<span id="cb18-46"><a href="#cb18-46"></a></span>
<span id="cb18-47"><a href="#cb18-47"></a>composed_param<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">sapply</span>(composed_param<span class="sc">$</span>composed.subtype,</span>
<span id="cb18-48"><a href="#cb18-48"></a>    <span class="cf">function</span>(x) <span class="fu">unique</span>(combined_anns<span class="sc">$</span>composed.subtype.label[combined_anns<span class="sc">$</span>composed.subtype <span class="sc">==</span></span>
<span id="cb18-49"><a href="#cb18-49"></a>        x]))</span>
<span id="cb18-50"><a href="#cb18-50"></a></span>
<span id="cb18-51"><a href="#cb18-51"></a></span>
<span id="cb18-52"><a href="#cb18-52"></a><span class="fu">write.csv</span>(composed_param, <span class="st">"./data/processed/accoustic_features_simple_and_composed_subtypes.csv"</span>,</span>
<span id="cb18-53"><a href="#cb18-53"></a>    <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="train-model" class="level3" data-number="7.4.1">
<h3 data-number="7.4.1" class="anchored" data-anchor-id="train-model"><span class="header-section-number">7.4.1</span> Train model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>composed_param <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/accoustic_features_simple_and_composed_subtypes.csv"</span>)</span>
<span id="cb19-2"><a href="#cb19-2"></a></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="co"># keep only multi-element</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>composed_param <span class="ot">&lt;-</span> composed_param[composed_param<span class="sc">$</span>num.elms <span class="sc">&gt;</span> <span class="dv">1</span>, ]</span>
<span id="cb19-5"><a href="#cb19-5"></a></span>
<span id="cb19-6"><a href="#cb19-6"></a>composed_param<span class="sc">$</span>song.rate[<span class="fu">is.infinite</span>(composed_param<span class="sc">$</span>song.rate)] <span class="ot">&lt;-</span> <span class="fu">mean</span>(composed_param<span class="sc">$</span>song.rate[<span class="sc">!</span><span class="fu">is.infinite</span>(composed_param<span class="sc">$</span>song.rate)])</span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co"># remove collinear</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>target_features <span class="ot">&lt;-</span> <span class="fu">names</span>(composed_param)[<span class="sc">!</span><span class="fu">names</span>(composed_param) <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>, <span class="st">"View"</span>, <span class="st">"Channel"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"bottom.freq"</span>, <span class="st">"top.freq"</span>, <span class="st">"Delta.Time..s."</span>, <span class="st">"Begin.File"</span>, <span class="st">"subtipos"</span>, <span class="st">"selec.file"</span>, <span class="st">"true.end"</span>, <span class="st">"ovlp.sels"</span>, <span class="st">"composed.subtype"</span>, <span class="st">"subtype.label"</span>, <span class="st">"composed.subtype.label"</span>, <span class="fu">names</span>(composed_param)[<span class="fu">sapply</span>(composed_param, anyNA)])]</span>
<span id="cb19-10"><a href="#cb19-10"></a></span>
<span id="cb19-11"><a href="#cb19-11"></a>cormat <span class="ot">&lt;-</span> <span class="fu">cor</span>(composed_param[, target_features], <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb19-12"><a href="#cb19-12"></a>hc <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(cormat, <span class="at">cutoff=</span> <span class="fl">0.9</span>) <span class="co"># putt any value as a "cutoff" </span></span>
<span id="cb19-13"><a href="#cb19-13"></a>hc <span class="ot">&lt;-</span> <span class="fu">sort</span>(hc)</span>
<span id="cb19-14"><a href="#cb19-14"></a></span>
<span id="cb19-15"><a href="#cb19-15"></a>target_features <span class="ot">&lt;-</span> target_features[hc]</span>
<span id="cb19-16"><a href="#cb19-16"></a></span>
<span id="cb19-17"><a href="#cb19-17"></a><span class="co"># Create data subsets</span></span>
<span id="cb19-18"><a href="#cb19-18"></a>partition <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(</span>
<span id="cb19-19"><a href="#cb19-19"></a>    <span class="at">y =</span> composed_param<span class="sc">$</span>composed.subtype.label,</span>
<span id="cb19-20"><a href="#cb19-20"></a>    <span class="at">times =</span> <span class="dv">1</span>,</span>
<span id="cb19-21"><a href="#cb19-21"></a>    <span class="at">p =</span> <span class="fl">0.75</span>,</span>
<span id="cb19-22"><a href="#cb19-22"></a>    <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb19-23"><a href="#cb19-23"></a>)</span>
<span id="cb19-24"><a href="#cb19-24"></a></span>
<span id="cb19-25"><a href="#cb19-25"></a></span>
<span id="cb19-26"><a href="#cb19-26"></a></span>
<span id="cb19-27"><a href="#cb19-27"></a>composed_param<span class="sc">$</span>composed_param<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(composed_param<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb19-28"><a href="#cb19-28"></a></span>
<span id="cb19-29"><a href="#cb19-29"></a>trainset <span class="ot">&lt;-</span> composed_param[partition, <span class="fu">c</span>(target_features, <span class="st">"composed.subtype.label"</span>)]</span>
<span id="cb19-30"><a href="#cb19-30"></a>testset <span class="ot">&lt;-</span> composed_param[<span class="sc">-</span>partition, <span class="fu">c</span>(target_features, <span class="st">"composed.subtype.label"</span>)]</span>
<span id="cb19-31"><a href="#cb19-31"></a></span>
<span id="cb19-32"><a href="#cb19-32"></a>trcontrol <span class="ot">&lt;-</span></span>
<span id="cb19-33"><a href="#cb19-33"></a>    <span class="fu">trainControl</span>(</span>
<span id="cb19-34"><a href="#cb19-34"></a>        <span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb19-35"><a href="#cb19-35"></a>        <span class="at">number =</span> <span class="dv">100</span>,</span>
<span id="cb19-36"><a href="#cb19-36"></a>        <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb19-37"><a href="#cb19-37"></a>        <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-38"><a href="#cb19-38"></a>        <span class="at">sampling =</span> <span class="st">"down"</span>,</span>
<span id="cb19-39"><a href="#cb19-39"></a>        <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb19-40"><a href="#cb19-40"></a>        <span class="at">returnResamp =</span> <span class="st">"all"</span></span>
<span id="cb19-41"><a href="#cb19-41"></a>    )</span>
<span id="cb19-42"><a href="#cb19-42"></a></span>
<span id="cb19-43"><a href="#cb19-43"></a>pred_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb19-44"><a href="#cb19-44"></a>    composed.subtype.label <span class="sc">~</span> .,</span>
<span id="cb19-45"><a href="#cb19-45"></a>    <span class="at">data =</span> trainset,</span>
<span id="cb19-46"><a href="#cb19-46"></a>    <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb19-47"><a href="#cb19-47"></a>    <span class="at">trControl =</span> trcontrol,</span>
<span id="cb19-48"><a href="#cb19-48"></a>    <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb19-49"><a href="#cb19-49"></a>    <span class="at">preProcess =</span> <span class="st">"scale"</span></span>
<span id="cb19-50"><a href="#cb19-50"></a>)</span>
<span id="cb19-51"><a href="#cb19-51"></a></span>
<span id="cb19-52"><a href="#cb19-52"></a><span class="co"># ggplot(pred_model) + theme_bw()</span></span>
<span id="cb19-53"><a href="#cb19-53"></a></span>
<span id="cb19-54"><a href="#cb19-54"></a><span class="co"># save confusion matrix</span></span>
<span id="cb19-55"><a href="#cb19-55"></a>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb19-56"><a href="#cb19-56"></a>    <span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(pred_model, testset), <span class="fu">as.factor</span>(testset<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb19-57"><a href="#cb19-57"></a></span>
<span id="cb19-58"><a href="#cb19-58"></a>conf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_mat<span class="sc">$</span>table)</span>
<span id="cb19-59"><a href="#cb19-59"></a></span>
<span id="cb19-60"><a href="#cb19-60"></a>conf_df<span class="sc">$</span>total <span class="ot">&lt;-</span></span>
<span id="cb19-61"><a href="#cb19-61"></a>    <span class="fu">sapply</span>(conf_df<span class="sc">$</span>Reference, <span class="cf">function</span>(x)</span>
<span id="cb19-62"><a href="#cb19-62"></a>        <span class="fu">sum</span>(testset<span class="sc">$</span>composed.subtype.label <span class="sc">==</span></span>
<span id="cb19-63"><a href="#cb19-63"></a>                x))</span>
<span id="cb19-64"><a href="#cb19-64"></a></span>
<span id="cb19-65"><a href="#cb19-65"></a>conf_df<span class="sc">$</span>proportion <span class="ot">&lt;-</span> conf_df<span class="sc">$</span>Freq <span class="sc">/</span> conf_df<span class="sc">$</span>total</span>
<span id="cb19-66"><a href="#cb19-66"></a></span>
<span id="cb19-67"><a href="#cb19-67"></a><span class="co"># fit model on complete data set</span></span>
<span id="cb19-68"><a href="#cb19-68"></a>best_rf_model <span class="ot">&lt;-</span> pred_model<span class="sc">$</span>finalModel</span>
<span id="cb19-69"><a href="#cb19-69"></a></span>
<span id="cb19-70"><a href="#cb19-70"></a><span class="co"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb19-71"><a href="#cb19-71"></a><span class="co">#   subtype.label ~ .,</span></span>
<span id="cb19-72"><a href="#cb19-72"></a><span class="co">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb19-73"><a href="#cb19-73"></a><span class="co">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb19-74"><a href="#cb19-74"></a><span class="co">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb19-75"><a href="#cb19-75"></a><span class="co">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb19-76"><a href="#cb19-76"></a><span class="co">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb19-77"><a href="#cb19-77"></a><span class="co">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb19-78"><a href="#cb19-78"></a><span class="co"># )</span></span>
<span id="cb19-79"><a href="#cb19-79"></a></span>
<span id="cb19-80"><a href="#cb19-80"></a>rf_model_results <span class="ot">&lt;-</span></span>
<span id="cb19-81"><a href="#cb19-81"></a>    <span class="fu">list</span>(</span>
<span id="cb19-82"><a href="#cb19-82"></a>        <span class="at">pred_model_bb =</span> pred_model,</span>
<span id="cb19-83"><a href="#cb19-83"></a>        <span class="at">conf_mat_bb =</span> conf_mat,</span>
<span id="cb19-84"><a href="#cb19-84"></a>        <span class="at">confusion_df_bb =</span> conf_df,</span>
<span id="cb19-85"><a href="#cb19-85"></a>        <span class="at">testset_bb =</span> testset</span>
<span id="cb19-86"><a href="#cb19-86"></a>        <span class="co">#all_rf_model = all_rf_model</span></span>
<span id="cb19-87"><a href="#cb19-87"></a>    )</span>
<span id="cb19-88"><a href="#cb19-88"></a></span>
<span id="cb19-89"><a href="#cb19-89"></a><span class="fu">saveRDS</span>(</span>
<span id="cb19-90"><a href="#cb19-90"></a>    rf_model_results,</span>
<span id="cb19-91"><a href="#cb19-91"></a>    <span class="st">"./data/processed/random_forest_model_results_composed_subtypes.RDS"</span></span>
<span id="cb19-92"><a href="#cb19-92"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="checking-performance-on-test-data-1" class="level3" data-number="7.4.2">
<h3 data-number="7.4.2" class="anchored" data-anchor-id="checking-performance-on-test-data-1"><span class="header-section-number">7.4.2</span> Checking performance on test data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>rf_model_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/processed/random_forest_model_results_composed_subtypes.RDS"</span>)</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a></span>
<span id="cb20-4"><a href="#cb20-4"></a><span class="co"># print confusion matrix results</span></span>
<span id="cb20-5"><a href="#cb20-5"></a>rf_model_results<span class="sc">$</span>conf_mat_bb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         composed.complex composed.trill step.flat step.flat.trill
  composed.complex              140              1         0               1
  composed.trill                 25              2         0               7
  step.flat                       4              0         2               5
  step.flat.trill                22              2         1              12
  step.trill                     98              2         0               5
                  Reference
Prediction         step.trill
  composed.complex         62
  composed.trill           90
  step.flat                14
  step.flat.trill          50
  step.trill              271

Overall Statistics
                                        
               Accuracy : 0.523         
                 95% CI : (0.488, 0.558)
    No Information Rate : 0.597         
    P-Value [Acc &gt; NIR] : 1             
                                        
                  Kappa : 0.245         
                                        
 Mcnemar's Test P-Value : NA            

Statistics by Class:

                     Class: composed.complex Class: composed.trill
Sensitivity                            0.484               0.28571
Specificity                            0.879               0.84920
Pos Pred Value                         0.686               0.01613
Neg Pred Value                         0.757               0.99277
Prevalence                             0.354               0.00858
Detection Rate                         0.172               0.00245
Detection Prevalence                   0.250               0.15196
Balanced Accuracy                      0.681               0.56746
                     Class: step.flat Class: step.flat.trill Class: step.trill
Sensitivity                   0.66667                 0.4000             0.556
Specificity                   0.97171                 0.9046             0.681
Pos Pred Value                0.08000                 0.1379             0.721
Neg Pred Value                0.99874                 0.9753             0.509
Prevalence                    0.00368                 0.0368             0.597
Detection Rate                0.00245                 0.0147             0.332
Detection Prevalence          0.03064                 0.1066             0.461
Balanced Accuracy             0.81919                 0.6523             0.619</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>confusion_df <span class="ot">&lt;-</span> rf_model_results<span class="sc">$</span>confusion_df_bb</span>
<span id="cb22-2"><a href="#cb22-2"></a></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="fu">ggplot</span>(confusion_df, <span class="fu">aes</span>(<span class="at">x =</span> Reference, <span class="at">y =</span> Prediction, <span class="at">fill =</span> proportion)) <span class="sc">+</span></span>
<span id="cb22-4"><a href="#cb22-4"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="fu">coord_equal</span>() <span class="sc">+</span> <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>,</span>
<span id="cb22-5"><a href="#cb22-5"></a>    <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(proportion, <span class="dv">2</span>)),</span>
<span id="cb22-6"><a href="#cb22-6"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed"</span>,</span>
<span id="cb22-7"><a href="#cb22-7"></a>    <span class="at">y =</span> <span class="st">"Predicted"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb22-8"><a href="#cb22-8"></a>    <span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>, <span class="at">hjust =</span> <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-539a35d47e664c97a50115a146a7f1bd-2" class="quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div>
<img src="checking_annotations_files/figure-html/unnamed-chunk-17-1.png" id="fig-539a35d47e664c97a50115a146a7f1bd-2" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="on-single-and-composed-multi-element-subtypes" class="level2" data-number="7.5">
<h2 data-number="7.5" class="anchored" data-anchor-id="on-single-and-composed-multi-element-subtypes"><span class="header-section-number">7.5</span> On single and composed (multi-element) subtypes</h2>
<section id="train-model-1" class="level3" data-number="7.5.1">
<h3 data-number="7.5.1" class="anchored" data-anchor-id="train-model-1"><span class="header-section-number">7.5.1</span> Train model</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>composed_param <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/accoustic_features_simple_and_composed_subtypes.csv"</span>)</span>
<span id="cb23-2"><a href="#cb23-2"></a></span>
<span id="cb23-3"><a href="#cb23-3"></a>composed_param <span class="ot">&lt;-</span> composed_param[composed_param<span class="sc">$</span>composed.subtype.label <span class="sc">!=</span> <span class="st">"22 kHz"</span>, ]</span>
<span id="cb23-4"><a href="#cb23-4"></a></span>
<span id="cb23-5"><a href="#cb23-5"></a>composed_param<span class="sc">$</span>song.rate[<span class="fu">is.infinite</span>(composed_param<span class="sc">$</span>song.rate)] <span class="ot">&lt;-</span> <span class="fu">mean</span>(composed_param<span class="sc">$</span>song.rate[<span class="sc">!</span><span class="fu">is.infinite</span>(composed_param<span class="sc">$</span>song.rate)])</span>
<span id="cb23-6"><a href="#cb23-6"></a></span>
<span id="cb23-7"><a href="#cb23-7"></a><span class="co"># remove collinear</span></span>
<span id="cb23-8"><a href="#cb23-8"></a>target_features <span class="ot">&lt;-</span> <span class="fu">names</span>(composed_param)[<span class="sc">!</span><span class="fu">names</span>(composed_param) <span class="sc">%in%</span>  <span class="fu">c</span>(<span class="st">"sound.files"</span>, <span class="st">"selec"</span>, <span class="st">"View"</span>, <span class="st">"Channel"</span>, <span class="st">"start"</span>, <span class="st">"end"</span>, <span class="st">"bottom.freq"</span>, <span class="st">"top.freq"</span>, <span class="st">"Delta.Time..s."</span>, <span class="st">"Begin.File"</span>, <span class="st">"subtipos"</span>, <span class="st">"selec.file"</span>, <span class="st">"true.end"</span>, <span class="st">"ovlp.sels"</span>, <span class="st">"composed.subtype"</span>, <span class="st">"subtype.label"</span>, <span class="st">"composed.subtype.label"</span> , <span class="st">"song.rate"</span>, <span class="fu">names</span>(composed_param)[<span class="fu">sapply</span>(composed_param, anyNA)])]</span>
<span id="cb23-9"><a href="#cb23-9"></a></span>
<span id="cb23-10"><a href="#cb23-10"></a>cormat <span class="ot">&lt;-</span> <span class="fu">cor</span>(composed_param[, target_features], <span class="at">use =</span> <span class="st">"pairwise.complete.obs"</span>)</span>
<span id="cb23-11"><a href="#cb23-11"></a>hc <span class="ot">&lt;-</span> <span class="fu">findCorrelation</span>(cormat, <span class="at">cutoff=</span> <span class="fl">0.9</span>) <span class="co"># putt any value as a "cutoff" </span></span>
<span id="cb23-12"><a href="#cb23-12"></a>hc <span class="ot">&lt;-</span> <span class="fu">sort</span>(hc)</span>
<span id="cb23-13"><a href="#cb23-13"></a></span>
<span id="cb23-14"><a href="#cb23-14"></a>target_features <span class="ot">&lt;-</span> target_features[hc]</span>
<span id="cb23-15"><a href="#cb23-15"></a></span>
<span id="cb23-16"><a href="#cb23-16"></a><span class="co"># Create data subsets</span></span>
<span id="cb23-17"><a href="#cb23-17"></a>partition <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(</span>
<span id="cb23-18"><a href="#cb23-18"></a>    <span class="at">y =</span> composed_param<span class="sc">$</span>composed.subtype.label,</span>
<span id="cb23-19"><a href="#cb23-19"></a>    <span class="at">times =</span> <span class="dv">1</span>,</span>
<span id="cb23-20"><a href="#cb23-20"></a>    <span class="at">p =</span> <span class="fl">0.75</span>,</span>
<span id="cb23-21"><a href="#cb23-21"></a>    <span class="at">list =</span> <span class="cn">FALSE</span></span>
<span id="cb23-22"><a href="#cb23-22"></a>)</span>
<span id="cb23-23"><a href="#cb23-23"></a></span>
<span id="cb23-24"><a href="#cb23-24"></a></span>
<span id="cb23-25"><a href="#cb23-25"></a></span>
<span id="cb23-26"><a href="#cb23-26"></a>composed_param<span class="sc">$</span>composed_param<span class="sc">$</span>composed.subtype.label <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(composed_param<span class="sc">$</span>composed.subtype.label)</span>
<span id="cb23-27"><a href="#cb23-27"></a></span>
<span id="cb23-28"><a href="#cb23-28"></a>trainset <span class="ot">&lt;-</span> composed_param[partition, <span class="fu">c</span>(target_features, <span class="st">"composed.subtype.label"</span>)]</span>
<span id="cb23-29"><a href="#cb23-29"></a>testset <span class="ot">&lt;-</span> composed_param[<span class="sc">-</span>partition, <span class="fu">c</span>(target_features, <span class="st">"composed.subtype.label"</span>)]</span>
<span id="cb23-30"><a href="#cb23-30"></a></span>
<span id="cb23-31"><a href="#cb23-31"></a>trcontrol <span class="ot">&lt;-</span></span>
<span id="cb23-32"><a href="#cb23-32"></a>    <span class="fu">trainControl</span>(</span>
<span id="cb23-33"><a href="#cb23-33"></a>        <span class="at">method =</span> <span class="st">"repeatedcv"</span>,</span>
<span id="cb23-34"><a href="#cb23-34"></a>        <span class="at">number =</span> <span class="dv">100</span>,</span>
<span id="cb23-35"><a href="#cb23-35"></a>        <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb23-36"><a href="#cb23-36"></a>        <span class="at">savePredictions =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-37"><a href="#cb23-37"></a>        <span class="at">sampling =</span> <span class="st">"down"</span>,</span>
<span id="cb23-38"><a href="#cb23-38"></a>        <span class="at">classProbs =</span> <span class="cn">TRUE</span>,</span>
<span id="cb23-39"><a href="#cb23-39"></a>        <span class="at">returnResamp =</span> <span class="st">"all"</span></span>
<span id="cb23-40"><a href="#cb23-40"></a>    )</span>
<span id="cb23-41"><a href="#cb23-41"></a></span>
<span id="cb23-42"><a href="#cb23-42"></a>pred_model <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb23-43"><a href="#cb23-43"></a>    composed.subtype.label <span class="sc">~</span> .,</span>
<span id="cb23-44"><a href="#cb23-44"></a>    <span class="at">data =</span> trainset,</span>
<span id="cb23-45"><a href="#cb23-45"></a>    <span class="at">method =</span> <span class="st">"rf"</span>,</span>
<span id="cb23-46"><a href="#cb23-46"></a>    <span class="at">trControl =</span> trcontrol,</span>
<span id="cb23-47"><a href="#cb23-47"></a>    <span class="at">metric =</span> <span class="st">"Accuracy"</span>,</span>
<span id="cb23-48"><a href="#cb23-48"></a>    <span class="at">preProcess =</span> <span class="st">"scale"</span></span>
<span id="cb23-49"><a href="#cb23-49"></a>)</span>
<span id="cb23-50"><a href="#cb23-50"></a></span>
<span id="cb23-51"><a href="#cb23-51"></a><span class="fu">ggplot</span>(pred_model) <span class="sc">+</span> <span class="fu">theme_bw</span>()</span>
<span id="cb23-52"><a href="#cb23-52"></a></span>
<span id="cb23-53"><a href="#cb23-53"></a><span class="co"># save confusion matrix</span></span>
<span id="cb23-54"><a href="#cb23-54"></a>conf_mat <span class="ot">&lt;-</span></span>
<span id="cb23-55"><a href="#cb23-55"></a>    <span class="fu">confusionMatrix</span>(<span class="fu">predict</span>(pred_model, testset), <span class="fu">as.factor</span>(testset<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb23-56"><a href="#cb23-56"></a></span>
<span id="cb23-57"><a href="#cb23-57"></a>conf_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(conf_mat<span class="sc">$</span>table)</span>
<span id="cb23-58"><a href="#cb23-58"></a></span>
<span id="cb23-59"><a href="#cb23-59"></a>conf_df<span class="sc">$</span>total <span class="ot">&lt;-</span></span>
<span id="cb23-60"><a href="#cb23-60"></a>    <span class="fu">sapply</span>(conf_df<span class="sc">$</span>Reference, <span class="cf">function</span>(x)</span>
<span id="cb23-61"><a href="#cb23-61"></a>        <span class="fu">sum</span>(testset<span class="sc">$</span>composed.subtype.label <span class="sc">==</span></span>
<span id="cb23-62"><a href="#cb23-62"></a>                x))</span>
<span id="cb23-63"><a href="#cb23-63"></a></span>
<span id="cb23-64"><a href="#cb23-64"></a>conf_df<span class="sc">$</span>proportion <span class="ot">&lt;-</span> conf_df<span class="sc">$</span>Freq <span class="sc">/</span> conf_df<span class="sc">$</span>total</span>
<span id="cb23-65"><a href="#cb23-65"></a></span>
<span id="cb23-66"><a href="#cb23-66"></a><span class="co"># fit model on complete data set</span></span>
<span id="cb23-67"><a href="#cb23-67"></a>best_rf_model <span class="ot">&lt;-</span> pred_model<span class="sc">$</span>finalModel</span>
<span id="cb23-68"><a href="#cb23-68"></a></span>
<span id="cb23-69"><a href="#cb23-69"></a><span class="co"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb23-70"><a href="#cb23-70"></a><span class="co">#   subtype.label ~ .,</span></span>
<span id="cb23-71"><a href="#cb23-71"></a><span class="co">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb23-72"><a href="#cb23-72"></a><span class="co">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb23-73"><a href="#cb23-73"></a><span class="co">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb23-74"><a href="#cb23-74"></a><span class="co">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb23-75"><a href="#cb23-75"></a><span class="co">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb23-76"><a href="#cb23-76"></a><span class="co">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb23-77"><a href="#cb23-77"></a><span class="co"># )</span></span>
<span id="cb23-78"><a href="#cb23-78"></a></span>
<span id="cb23-79"><a href="#cb23-79"></a>rf_model_results <span class="ot">&lt;-</span></span>
<span id="cb23-80"><a href="#cb23-80"></a>    <span class="fu">list</span>(</span>
<span id="cb23-81"><a href="#cb23-81"></a>        <span class="at">pred_model_bb =</span> pred_model,</span>
<span id="cb23-82"><a href="#cb23-82"></a>        <span class="at">conf_mat_bb =</span> conf_mat,</span>
<span id="cb23-83"><a href="#cb23-83"></a>        <span class="at">confusion_df_bb =</span> conf_df,</span>
<span id="cb23-84"><a href="#cb23-84"></a>        <span class="at">testset_bb =</span> testset</span>
<span id="cb23-85"><a href="#cb23-85"></a>        <span class="co">#all_rf_model = all_rf_model</span></span>
<span id="cb23-86"><a href="#cb23-86"></a>    )</span>
<span id="cb23-87"><a href="#cb23-87"></a></span>
<span id="cb23-88"><a href="#cb23-88"></a><span class="fu">saveRDS</span>(</span>
<span id="cb23-89"><a href="#cb23-89"></a>    rf_model_results,</span>
<span id="cb23-90"><a href="#cb23-90"></a>    <span class="st">"./data/processed/random_forest_model_results_single_and_composed_subtypes.RDS"</span></span>
<span id="cb23-91"><a href="#cb23-91"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="checking-performance-on-test-data-2" class="level3" data-number="7.5.2">
<h3 data-number="7.5.2" class="anchored" data-anchor-id="checking-performance-on-test-data-2"><span class="header-section-number">7.5.2</span> Checking performance on test data</h3>
<div class="cell">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>rf_model_results <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"./data/processed/random_forest_model_results_single_and_composed_subtypes.RDS"</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co"># print confusion matrix results</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>rf_model_results<span class="sc">$</span>conf_mat_bb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

                  Reference
Prediction         complex composed.complex composed.trill flat step.flat
  complex              293               63              0    0         0
  composed.complex      16              121              2    0         0
  composed.trill         3               18              4   10         1
  flat                   0                0              0   46         0
  step.flat             16               10              1   39         2
  step.flat.trill        0               14              0    3         0
  step.trill             0               57              0    0         0
  trill                  8                6              0   10         0
                  Reference
Prediction         step.flat.trill step.trill trill
  complex                        0          5   120
  composed.complex               1        107   197
  composed.trill                 4         67   389
  flat                           0          3   385
  step.flat                     11         33   251
  step.flat.trill                7         49    97
  step.trill                     7        215    99
  trill                          0          8   581

Overall Statistics
                                        
               Accuracy : 0.376         
                 95% CI : (0.359, 0.392)
    No Information Rate : 0.627         
    P-Value [Acc &gt; NIR] : 1             
                                        
                  Kappa : 0.256         
                                        
 Mcnemar's Test P-Value : NA            

Statistics by Class:

                     Class: complex Class: composed.complex
Sensitivity                  0.8720                  0.4187
Specificity                  0.9382                  0.8955
Pos Pred Value               0.6091                  0.2725
Neg Pred Value               0.9852                  0.9428
Prevalence                   0.0994                  0.0855
Detection Rate               0.0867                  0.0358
Detection Prevalence         0.1423                  0.1314
Balanced Accuracy            0.9051                  0.6571
                     Class: composed.trill Class: flat Class: step.flat
Sensitivity                        0.57143      0.4259         0.666667
Specificity                        0.85409      0.8814         0.893069
Pos Pred Value                     0.00806      0.1060         0.005510
Neg Pred Value                     0.99896      0.9789         0.999668
Prevalence                         0.00207      0.0320         0.000888
Detection Rate                     0.00118      0.0136         0.000592
Detection Prevalence               0.14679      0.1284         0.107428
Balanced Accuracy                  0.71276      0.6537         0.779868
                     Class: step.flat.trill Class: step.trill Class: trill
Sensitivity                         0.23333            0.4415        0.274
Specificity                         0.95133            0.9436        0.975
Pos Pred Value                      0.04118            0.5688        0.948
Neg Pred Value                      0.99283            0.9094        0.444
Prevalence                          0.00888            0.1441        0.627
Detection Rate                      0.00207            0.0636        0.172
Detection Prevalence                0.05031            0.1119        0.181
Balanced Accuracy                   0.59233            0.6926        0.624</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r numberLines lineAnchors code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>confusion_df <span class="ot">&lt;-</span> rf_model_results<span class="sc">$</span>confusion_df_bb</span>
<span id="cb26-2"><a href="#cb26-2"></a></span>
<span id="cb26-3"><a href="#cb26-3"></a><span class="fu">ggplot</span>(confusion_df, <span class="fu">aes</span>(<span class="at">x =</span> Reference, <span class="at">y =</span> Prediction, <span class="at">fill =</span> proportion)) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4"></a>    <span class="fu">geom_tile</span>() <span class="sc">+</span> <span class="fu">coord_equal</span>() <span class="sc">+</span> <span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">"Greens"</span>,</span>
<span id="cb26-5"><a href="#cb26-5"></a>    <span class="at">direction =</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">round</span>(proportion, <span class="dv">2</span>)),</span>
<span id="cb26-6"><a href="#cb26-6"></a>    <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> <span class="fu">theme_classic</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Observed"</span>,</span>
<span id="cb26-7"><a href="#cb26-7"></a>    <span class="at">y =</span> <span class="st">"Predicted"</span>) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb26-8"><a href="#cb26-8"></a>    <span class="at">size =</span> <span class="dv">11</span>, <span class="at">angle =</span> <span class="dv">30</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>, <span class="at">hjust =</span> <span class="fl">0.8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-539a35d47e664c97a50115a146a7f1bd-3" class="quarto-figure quarto-figure-center anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div>
<img src="checking_annotations_files/figure-html/unnamed-chunk-19-1.png" id="fig-539a35d47e664c97a50115a146a7f1bd-3" class="img-fluid figure-img" width="672">
</div>
</figure>
</div>
</div>
</div>
<!-- light green box -->
</section>
</section>
</section>
<section id="takeaways" class="level1 unnumbered unlisted alert alert-success">
<h1 class="unnumbered unlisted">Takeaways</h1>
<ul>
<li>Good classification of single element subtypes (accuracy: 0.76)</li>
<li>Poor classification of composed subtypes (accuracy: 0.52 and 0.37 when including single-element subtypes)</li>
</ul>
</section>
<p>&nbsp;</p>
<!-- '---' adds a gray vertical line -->
<hr>
<p>&nbsp;</p>
<section id="to-do-list" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> To-do list</h1>
<ul>
<li>Try other classification methods (VGGish, BirdNet, google model)</li>
<li>arreglar subtipos vacíos (NAs) y con etiquetas 5 y 44</li>
<li>buscar ejemplos específicos de subtipos raros para aumentar n de entrenamiento</li>
<li>buscar grabaciones completas (o cortes) con subtipos raros para n de prueba</li>
</ul>
<p><font size="4">Session information</font></p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 20.04.2 LTS

Matrix products: default
BLAS:   /usr/lib/x86_64-linux-gnu/atlas/libblas.so.3.10.3 
LAPACK: /usr/lib/x86_64-linux-gnu/atlas/liblapack.so.3.10.3;  LAPACK version 3.9.0

locale:
 [1] LC_CTYPE=pt_BR.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=es_CR.UTF-8        LC_COLLATE=pt_BR.UTF-8    
 [5] LC_MONETARY=es_CR.UTF-8    LC_MESSAGES=pt_BR.UTF-8   
 [7] LC_PAPER=es_CR.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=es_CR.UTF-8 LC_IDENTIFICATION=C       

time zone: America/Costa_Rica
tzcode source: system (glibc)

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] DiagrammeR_1.0.10    randomForest_4.7-1.1 caret_6.0-94        
 [4] lattice_0.22-5       ggplot2_3.4.4        ohun_1.0.0          
 [7] Rraven_1.0.14        warbleR_1.1.29       NatureSounds_1.0.4  
[10] seewave_2.2.3        tuneR_1.4.5          viridis_0.6.4       
[13] viridisLite_0.4.2    formatR_1.14         knitr_1.45          

loaded via a namespace (and not attached):
 [1] DBI_1.1.3            bitops_1.0-7         pROC_1.18.5         
 [4] pbapply_1.7-2        gridExtra_2.3        remotes_2.4.2.1     
 [7] testthat_3.2.0       rlang_1.1.2          magrittr_2.0.3      
[10] e1071_1.7-13         compiler_4.3.1       vctrs_0.6.4         
[13] reshape2_1.4.4       stringr_1.5.0        pkgconfig_2.0.3     
[16] crayon_1.5.2         fastmap_1.1.1        backports_1.4.1     
[19] labeling_0.4.3       utf8_1.2.4           rmarkdown_2.25      
[22] prodlim_2023.08.28   purrr_1.0.2          xfun_0.41           
[25] jsonlite_1.8.7       recipes_1.0.8        parallel_4.3.1      
[28] R6_2.5.1             RColorBrewer_1.1-3   stringi_1.7.12      
[31] parallelly_1.36.0    rpart_4.1.21         brio_1.1.3          
[34] lubridate_1.9.3      Rcpp_1.0.11          iterators_1.0.14    
[37] future.apply_1.11.0  Matrix_1.6-2         splines_4.3.1       
[40] nnet_7.3-19          igraph_1.5.1         timechange_0.2.0    
[43] tidyselect_1.2.0     rstudioapi_0.15.0    yaml_2.3.7          
[46] timeDate_4022.108    codetools_0.2-19     dtw_1.23-1          
[49] listenv_0.9.0        tibble_3.2.1         plyr_1.8.9          
[52] withr_2.5.2          evaluate_0.23        signal_0.7-7        
[55] future_1.33.0        survival_3.5-7       sf_1.0-14           
[58] sketchy_1.0.2        units_0.8-4          proxy_0.4-27        
[61] pillar_1.9.0         packrat_0.9.2        KernSmooth_2.23-22  
[64] stats4_4.3.1         checkmate_2.3.0      foreach_1.5.2       
[67] generics_0.1.3       RCurl_1.98-1.13      munsell_0.5.0       
[70] scales_1.2.1         globals_0.16.2       class_7.3-22        
[73] glue_1.6.2           tools_4.3.1          xaringanExtra_0.7.0 
[76] data.table_1.14.8    ModelMetrics_1.2.2.2 gower_1.0.1         
[79] visNetwork_2.1.2     grid_4.3.1           ipred_0.9-14        
[82] colorspace_2.1-0     nlme_3.1-163         cli_3.6.1           
[85] fansi_1.0.5          lava_1.7.3           dplyr_1.1.3         
[88] gtable_0.3.4         fftw_1.0-7           digest_0.6.33       
[91] classInt_0.4-10      farver_2.1.1         rjson_0.2.21        
[94] htmlwidgets_1.6.2    htmltools_0.5.7      lifecycle_1.0.4     
[97] hardhat_1.3.0        MASS_7.3-60         </code></pre>
</div>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        for (let i = 0; i < 2; i++) {
          container.appendChild(note.children[i].cloneNode(true));
        }
        return container.innerHTML
      } else {
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> Classifying USV subtypes</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> Rat vocalization and alcohol</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> &lt;a href="https://marce10.github.io/"&gt;Marcelo Araya-Salas&lt;/a&gt;</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="an">toc:</span><span class="co"> true</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="an">toc-depth:</span><span class="co"> 2</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="an">toc-location:</span><span class="co"> left</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="an">number-sections:</span><span class="co"> true</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="an">highlight-style:</span><span class="co"> pygments</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">    df-print: kable</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">    css: qmd.css</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a><span class="in">```{=html}</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;style&gt;</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="in">body</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a><span class="in">  { counter-reset: source-line 0; }</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="in">pre.numberSource code</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="in">  { counter-reset: none; }</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a><span class="in">&lt;/style&gt;</span></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a><span class="in">```{r set root directory, echo = FALSE}</span></span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a><span class="in"># set working directory as project directory or one directory above,</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_knit$set(root.dir = "..")</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r add link to github repo, echo = FALSE, results='asis'}</span></span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="in"># print link to github repo if any</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="in">if (file.exists("./.git/config")){</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a><span class="in">  config &lt;- readLines("./.git/config")</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a><span class="in">  url &lt;- grep("url",  config, value = TRUE)</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a><span class="in">  url &lt;- gsub("\\turl = |.git$", "", url)</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="in">  cat("\nSource code and data found at [", url, "](", url, ")", sep = "")</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a><span class="in">```{r setup style, echo = FALSE, message = FALSE, warning=FALSE}</span></span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a><span class="in"># options to customize chunk outputs</span></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::opts_chunk$set(</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="in">  class.source = "numberLines lineAnchors", # for code line numbers</span></span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy.opts = list(width.cutoff = 65), </span></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="in">  tidy = TRUE,</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a><span class="in">  message = FALSE</span></span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a><span class="in"> )</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span> </span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- skyblue box --&gt;</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-info"&gt;</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a><span class="fu"># Purpose</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Classify subtypes based on structure</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Determine multi-element subtypes based on composing single subtypes</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span> </span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a><span class="fu"># Load packages {.unnumbered .unlisted}</span></span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a><span class="in">```{r load packages}</span></span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a><span class="in"># knitr is require for creating html/pdf/word reports</span></span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a><span class="in"># formatR is used for soft-wrapping code</span></span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a><span class="in"># install/ load packages</span></span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a><span class="in">sketchy::load_packages(packages = c("knitr", "formatR", "viridis", "warbleR", github = "maRce10/Rraven", github = "maRce10/warbleR", github = "maRce10/ohun", "caret", "randomForest", "DiagrammeR"))</span></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a><span class="in">warbleR_options(wav.path = "/media/m/Expansion/audios_cin_alcohol_2023")</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a><span class="fu"># Read data {.unnumbered .unlisted}</span></span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- imp_raven("./data/processed/annotations", warbler.format = TRUE, all.data = TRUE)</span></span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subc &lt;- anns$subtipos_completo &lt;- NULL</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- anns[!is.na(anns$subtipos), ]</span></span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtipos[anns$subtipos  %in% c(5, 44)] &lt;- 4</span></span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- anns[order(anns$sound.files, anns$start), ]</span></span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a><span class="in">nrow(anns)</span></span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- anns[anns$start &lt; anns$end, ]</span></span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtype.label &lt;- NA</span></span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtype.label[anns$subtipos == 22] &lt;- "22 kHz"</span></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtype.label[anns$subtipos == 1] &lt;- "flat"</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtype.label[anns$subtipos == 4] &lt;- "trill"</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a><span class="in">anns$subtype.label[anns$subtipos == 6] &lt;- "complex"</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a><span class="fu"># Describe annotations (single element subtypes)</span></span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Proportion of calls per subtype</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>This is the annotation data without any modification</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(anns<span class="sc">$</span>subtype.label)<span class="sc">/</span> <span class="fu">nrow</span>(anns), <span class="dv">2</span>)</span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(anns<span class="sc">$</span>subtype.label))</span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a>count_types</span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-136"><a href="#cb28-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-137"><a href="#cb28-137" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data analysis</span></span>
<span id="cb28-138"><a href="#cb28-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-141"><a href="#cb28-141" aria-hidden="true" tabindex="-1"></a><span class="in">```{mermaid}</span></span>
<span id="cb28-142"><a href="#cb28-142" aria-hidden="true" tabindex="-1"></a><span class="in">flowchart LR</span></span>
<span id="cb28-143"><a href="#cb28-143" aria-hidden="true" tabindex="-1"></a><span class="in">  A[Annotations] --&gt; C(Measure\nsingle-note\nsubtype\nstructure)</span></span>
<span id="cb28-144"><a href="#cb28-144" aria-hidden="true" tabindex="-1"></a><span class="in">  B[recordings] --&gt; C</span></span>
<span id="cb28-145"><a href="#cb28-145" aria-hidden="true" tabindex="-1"></a><span class="in">  C --&gt; D(Build\ncomposed\nsubtypes)</span></span>
<span id="cb28-146"><a href="#cb28-146" aria-hidden="true" tabindex="-1"></a><span class="in">  C --&gt; E(Classify\nsimple\nsubtypes) </span></span>
<span id="cb28-147"><a href="#cb28-147" aria-hidden="true" tabindex="-1"></a><span class="in">  D --&gt; F(Classify\ncomposed\nsubtypes)</span></span>
<span id="cb28-148"><a href="#cb28-148" aria-hidden="true" tabindex="-1"></a><span class="in">  F --&gt; G(Evaluate classification)</span></span>
<span id="cb28-149"><a href="#cb28-149" aria-hidden="true" tabindex="-1"></a><span class="in">  E --&gt; G</span></span>
<span id="cb28-150"><a href="#cb28-150" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb28-151"><a href="#cb28-151" aria-hidden="true" tabindex="-1"></a><span class="in">style A fill:#44015466</span></span>
<span id="cb28-152"><a href="#cb28-152" aria-hidden="true" tabindex="-1"></a><span class="in">style B fill:#3E4A894D</span></span>
<span id="cb28-153"><a href="#cb28-153" aria-hidden="true" tabindex="-1"></a><span class="in">style C fill:#26828E4D</span></span>
<span id="cb28-154"><a href="#cb28-154" aria-hidden="true" tabindex="-1"></a><span class="in">style D fill:#31688E4D</span></span>
<span id="cb28-155"><a href="#cb28-155" aria-hidden="true" tabindex="-1"></a><span class="in">style E fill:#6DCD594D</span></span>
<span id="cb28-156"><a href="#cb28-156" aria-hidden="true" tabindex="-1"></a><span class="in">style G fill:#FDE7254D</span></span>
<span id="cb28-157"><a href="#cb28-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-158"><a href="#cb28-158" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-159"><a href="#cb28-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-160"><a href="#cb28-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo = FALSE}</span></span>
<span id="cb28-161"><a href="#cb28-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-162"><a href="#cb28-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-163"><a href="#cb28-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-164"><a href="#cb28-164" aria-hidden="true" tabindex="-1"></a><span class="in"># r must be changed to dot</span></span>
<span id="cb28-165"><a href="#cb28-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-166"><a href="#cb28-166" aria-hidden="true" tabindex="-1"></a><span class="in">digraph {</span></span>
<span id="cb28-167"><a href="#cb28-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-168"><a href="#cb28-168" aria-hidden="true" tabindex="-1"></a><span class="in">graph [layout = dot]</span></span>
<span id="cb28-169"><a href="#cb28-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-170"><a href="#cb28-170" aria-hidden="true" tabindex="-1"></a><span class="in"># define the global styles of the nodes. We can override these in box if we wish</span></span>
<span id="cb28-171"><a href="#cb28-171" aria-hidden="true" tabindex="-1"></a><span class="in">node [shape = rectangle, style = filled, fillcolor = Linen]</span></span>
<span id="cb28-172"><a href="#cb28-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-173"><a href="#cb28-173" aria-hidden="true" tabindex="-1"></a><span class="in">annotations [label = "Annotations", shape = rectangle, fillcolor = "#44015466"]</span></span>
<span id="cb28-174"><a href="#cb28-174" aria-hidden="true" tabindex="-1"></a><span class="in">recordings [label = "Recordings", shape = rectangle, fillcolor = "#3E4A894D"]</span></span>
<span id="cb28-175"><a href="#cb28-175" aria-hidden="true" tabindex="-1"></a><span class="in">structure [label = "Measure\nsingle-note\nsubtype\nstructure", fillcolor = "#26828E4D"]</span></span>
<span id="cb28-176"><a href="#cb28-176" aria-hidden="true" tabindex="-1"></a><span class="in">simple [label = "Classify\nsimple\nsubtypes", fillcolor = "#6DCD594D"]</span></span>
<span id="cb28-177"><a href="#cb28-177" aria-hidden="true" tabindex="-1"></a><span class="in">bcomposed [label = "Build\ncomposed\nsubtypes", fillcolor = "#31688E4D"]</span></span>
<span id="cb28-178"><a href="#cb28-178" aria-hidden="true" tabindex="-1"></a><span class="in">class [label = "Classify\ncomposed\nsubtypes", fillcolor = "#6DCD594D"]</span></span>
<span id="cb28-179"><a href="#cb28-179" aria-hidden="true" tabindex="-1"></a><span class="in">eval [label = "Evaluate classification", fillcolor = "#FDE7254D"]</span></span>
<span id="cb28-180"><a href="#cb28-180" aria-hidden="true" tabindex="-1"></a><span class="in"># edge definitions with the node IDs</span></span>
<span id="cb28-181"><a href="#cb28-181" aria-hidden="true" tabindex="-1"></a><span class="in">{annotations recordings}  -&gt; structure -&gt; bcomposed -&gt; class -&gt; eval</span></span>
<span id="cb28-182"><a href="#cb28-182" aria-hidden="true" tabindex="-1"></a><span class="in">structure -&gt; simple</span></span>
<span id="cb28-183"><a href="#cb28-183" aria-hidden="true" tabindex="-1"></a><span class="in">simple -&gt; eval</span></span>
<span id="cb28-184"><a href="#cb28-184" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb28-185"><a href="#cb28-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-186"><a href="#cb28-186" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-187"><a href="#cb28-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-188"><a href="#cb28-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-189"><a href="#cb28-189" aria-hidden="true" tabindex="-1"></a><span class="fu"># Measure acoustic structure</span></span>
<span id="cb28-190"><a href="#cb28-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-191"><a href="#cb28-191" aria-hidden="true" tabindex="-1"></a>Acoustic structure measured as spectrographic/spectrum/envelope features as well as statistical descriptors of Mel frequency cepstral coefficients </span>
<span id="cb28-192"><a href="#cb28-192" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-193"><a href="#cb28-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-194"><a href="#cb28-194" aria-hidden="true" tabindex="-1"></a><span class="in">cs &lt;- check_sels(anns, parallel = 1)</span></span>
<span id="cb28-195"><a href="#cb28-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-196"><a href="#cb28-196" aria-hidden="true" tabindex="-1"></a><span class="in">sp &lt;- spectro_analysis(anns, parallel = 5, ovlp = 70)</span></span>
<span id="cb28-197"><a href="#cb28-197" aria-hidden="true" tabindex="-1"></a><span class="in">mfccs &lt;- mfcc_stats(anns, parallel = 5, ovlp = 70)</span></span>
<span id="cb28-198"><a href="#cb28-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-199"><a href="#cb28-199" aria-hidden="true" tabindex="-1"></a><span class="in">anns_sp &lt;- merge(anns, sp)</span></span>
<span id="cb28-200"><a href="#cb28-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-201"><a href="#cb28-201" aria-hidden="true" tabindex="-1"></a><span class="in">anns_sp &lt;- merge(anns_sp, mfccs)</span></span>
<span id="cb28-202"><a href="#cb28-202" aria-hidden="true" tabindex="-1"></a><span class="in">colnames(anns_sp)</span></span>
<span id="cb28-203"><a href="#cb28-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-204"><a href="#cb28-204" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(anns_sp, "./data/processed/annotations_and_spectrogram_and_mel_features.csv", row.names = FALSE)</span></span>
<span id="cb28-205"><a href="#cb28-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-206"><a href="#cb28-206" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-207"><a href="#cb28-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-208"><a href="#cb28-208" aria-hidden="true" tabindex="-1"></a><span class="fu"># Multi-element composed subtypes</span></span>
<span id="cb28-209"><a href="#cb28-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-210"><a href="#cb28-210" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Define as those in which single elements are within a 5 ms range</span>
<span id="cb28-211"><a href="#cb28-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-212"><a href="#cb28-212" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-213"><a href="#cb28-213" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- read.csv("./data/processed/annotations_and_spectrogram_and_mel_features.csv")</span></span>
<span id="cb28-214"><a href="#cb28-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-215"><a href="#cb28-215" aria-hidden="true" tabindex="-1"></a><span class="in">anns$true.end &lt;- anns$end </span></span>
<span id="cb28-216"><a href="#cb28-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-217"><a href="#cb28-217" aria-hidden="true" tabindex="-1"></a><span class="in">anns$end &lt;- anns$end + 0.005 </span></span>
<span id="cb28-218"><a href="#cb28-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-219"><a href="#cb28-219" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- overlapping_sels(anns)</span></span>
<span id="cb28-220"><a href="#cb28-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-221"><a href="#cb28-221" aria-hidden="true" tabindex="-1"></a><span class="in">anns$end &lt;- anns$true.end</span></span>
<span id="cb28-222"><a href="#cb28-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-223"><a href="#cb28-223" aria-hidden="true" tabindex="-1"></a><span class="in">anns$true.end &lt;- NULL</span></span>
<span id="cb28-224"><a href="#cb28-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-225"><a href="#cb28-225" aria-hidden="true" tabindex="-1"></a><span class="in"># add song label to elements</span></span>
<span id="cb28-226"><a href="#cb28-226" aria-hidden="true" tabindex="-1"></a><span class="in">anns$composed.subtype &lt;- anns$ovlp.sels</span></span>
<span id="cb28-227"><a href="#cb28-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-228"><a href="#cb28-228" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in seq_len(nrow(anns)))</span></span>
<span id="cb28-229"><a href="#cb28-229" aria-hidden="true" tabindex="-1"></a><span class="in">    if (is.na(anns$composed.subtype[i]))</span></span>
<span id="cb28-230"><a href="#cb28-230" aria-hidden="true" tabindex="-1"></a><span class="in">        anns$composed.subtype[i] &lt;- max(anns$composed.subtype, na.rm = TRUE) + 1</span></span>
<span id="cb28-231"><a href="#cb28-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-232"><a href="#cb28-232" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(anns, "./data/processed/annotations_groups_spectrogram_and_mel_features.csv", row.names = FALSE)</span></span>
<span id="cb28-233"><a href="#cb28-233" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-234"><a href="#cb28-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-235"><a href="#cb28-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-236"><a href="#cb28-236" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- light brown box --&gt;</span></span>
<span id="cb28-237"><a href="#cb28-237" aria-hidden="true" tabindex="-1"></a>&lt;div class="alert alert-warning"&gt;</span>
<span id="cb28-238"><a href="#cb28-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-239"><a href="#cb28-239" aria-hidden="true" tabindex="-1"></a><span class="fu">## Rules to determine composed subtypes</span></span>
<span id="cb28-240"><a href="#cb28-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-241"><a href="#cb28-241" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If any of the composing subtypes is complex then **composed complex**</span>
<span id="cb28-242"><a href="#cb28-242" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If it contains 3 or more single subtypes then **composed complex**</span>
<span id="cb28-243"><a href="#cb28-243" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If  'flat-trill' and 'trill-flat' then  **step flat trill**</span>
<span id="cb28-244"><a href="#cb28-244" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If it has at least two adjacent trills ('trill-trill') and the frequency change is equal or higher than 5 kHz then **step trill**</span>
<span id="cb28-245"><a href="#cb28-245" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>If it has at least two adjacent flats ('flat-flat') and the frequency change is equal or higher than 5 kHz then **step flat**</span>
<span id="cb28-246"><a href="#cb28-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-247"><a href="#cb28-247" aria-hidden="true" tabindex="-1"></a>&lt;/div&gt;</span>
<span id="cb28-248"><a href="#cb28-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-249"><a href="#cb28-249" aria-hidden="true" tabindex="-1"></a><span class="dv">&amp;nbsp;</span></span>
<span id="cb28-250"><a href="#cb28-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-251"><a href="#cb28-251" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-252"><a href="#cb28-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-253"><a href="#cb28-253" aria-hidden="true" tabindex="-1"></a><span class="in">anns &lt;- read.csv("./data/processed/annotations_groups_spectrogram_and_mel_features.csv")</span></span>
<span id="cb28-254"><a href="#cb28-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-255"><a href="#cb28-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-256"><a href="#cb28-256" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns_list &lt;- lapply(unique(na.omit(anns$ovlp.sels)), function(x){ </span></span>
<span id="cb28-257"><a href="#cb28-257" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-258"><a href="#cb28-258" aria-hidden="true" tabindex="-1"></a><span class="in">    data.frame(sound.files = anns$sound.files[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)][1],</span></span>
<span id="cb28-259"><a href="#cb28-259" aria-hidden="true" tabindex="-1"></a><span class="in">               selec = x,</span></span>
<span id="cb28-260"><a href="#cb28-260" aria-hidden="true" tabindex="-1"></a><span class="in">               start = min(anns$start[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)]),</span></span>
<span id="cb28-261"><a href="#cb28-261" aria-hidden="true" tabindex="-1"></a><span class="in">               end = max(anns$end[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)]),</span></span>
<span id="cb28-262"><a href="#cb28-262" aria-hidden="true" tabindex="-1"></a><span class="in">               bottom.freq = min(anns$bottom.freq[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)]),</span></span>
<span id="cb28-263"><a href="#cb28-263" aria-hidden="true" tabindex="-1"></a><span class="in">               top.freq = max(anns$top.freq[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)]),</span></span>
<span id="cb28-264"><a href="#cb28-264" aria-hidden="true" tabindex="-1"></a><span class="in">               subtypes = paste(anns$subtipos[anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels)], collapse = "-"),</span></span>
<span id="cb28-265"><a href="#cb28-265" aria-hidden="true" tabindex="-1"></a><span class="in">               composed.subtype = x,</span></span>
<span id="cb28-266"><a href="#cb28-266" aria-hidden="true" tabindex="-1"></a><span class="in">               count.subtypes = sum(anns$ovlp.sels == x &amp; !is.na(anns$ovlp.sels))</span></span>
<span id="cb28-267"><a href="#cb28-267" aria-hidden="true" tabindex="-1"></a><span class="in">               )</span></span>
<span id="cb28-268"><a href="#cb28-268" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb28-269"><a href="#cb28-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-270"><a href="#cb28-270" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns &lt;- do.call(rbind, composed_anns_list)</span></span>
<span id="cb28-271"><a href="#cb28-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-272"><a href="#cb28-272" aria-hidden="true" tabindex="-1"></a><span class="in">unique(composed_anns$subtypes)</span></span>
<span id="cb28-273"><a href="#cb28-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-274"><a href="#cb28-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-275"><a href="#cb28-275" aria-hidden="true" tabindex="-1"></a><span class="in"># subtypes &lt;- c(1 = "flat", 4 = "trill", 6 = "complejas", 22 = "22 kHz")</span></span>
<span id="cb28-276"><a href="#cb28-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-277"><a href="#cb28-277" aria-hidden="true" tabindex="-1"></a><span class="in"># add labels</span></span>
<span id="cb28-278"><a href="#cb28-278" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- NA</span></span>
<span id="cb28-279"><a href="#cb28-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-280"><a href="#cb28-280" aria-hidden="true" tabindex="-1"></a><span class="in"># of it contain complex subtype then is complex</span></span>
<span id="cb28-281"><a href="#cb28-281" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- ifelse(grepl("6", composed_anns$subtypes), "composed.complex", composed_anns$composed.subtype.label)</span></span>
<span id="cb28-282"><a href="#cb28-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-283"><a href="#cb28-283" aria-hidden="true" tabindex="-1"></a><span class="in"># of it contain 3 or more elements it is complex</span></span>
<span id="cb28-284"><a href="#cb28-284" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- ifelse(composed_anns$count.subtypes &gt;= 3, "composed.complex", composed_anns$composed.subtype.label)</span></span>
<span id="cb28-285"><a href="#cb28-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-286"><a href="#cb28-286" aria-hidden="true" tabindex="-1"></a><span class="in"># 1-4 and 4-1 is a 3 (trill flat steps)</span></span>
<span id="cb28-287"><a href="#cb28-287" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- ifelse(grepl("^1-4$|^4-1$", composed_anns$subtypes), "step.flat.trill", composed_anns$composed.subtype.label)</span></span>
<span id="cb28-288"><a href="#cb28-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-289"><a href="#cb28-289" aria-hidden="true" tabindex="-1"></a><span class="in"># if it has at least two adjacent 4 ("4-4" two trills) and the frequency change is equal or higher than 5 kHz it is a step</span></span>
<span id="cb28-290"><a href="#cb28-290" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- sapply(seq_len(nrow(composed_anns)), function(x){</span></span>
<span id="cb28-291"><a href="#cb28-291" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-292"><a href="#cb28-292" aria-hidden="true" tabindex="-1"></a><span class="in">    if(sum(grepl("4-4", composed_anns$subtypes[x])) &amp; composed_anns$count.subtypes[x] == 2) {</span></span>
<span id="cb28-293"><a href="#cb28-293" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-294"><a href="#cb28-294" aria-hidden="true" tabindex="-1"></a><span class="in">        peakfs &lt;- anns$meanpeakf[anns$composed.subtype ==  composed_anns$composed.subtype[x]]</span></span>
<span id="cb28-295"><a href="#cb28-295" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-296"><a href="#cb28-296" aria-hidden="true" tabindex="-1"></a><span class="in">        diff_freq &lt;- abs(peakfs[1] - peakfs[2])</span></span>
<span id="cb28-297"><a href="#cb28-297" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-298"><a href="#cb28-298" aria-hidden="true" tabindex="-1"></a><span class="in">    out &lt;- if (diff_freq &gt;= 5) "step.trill" else </span></span>
<span id="cb28-299"><a href="#cb28-299" aria-hidden="true" tabindex="-1"></a><span class="in">        "composed.trill"    </span></span>
<span id="cb28-300"><a href="#cb28-300" aria-hidden="true" tabindex="-1"></a><span class="in">    } else out &lt;- composed_anns$composed.subtype.label[x]</span></span>
<span id="cb28-301"><a href="#cb28-301" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-302"><a href="#cb28-302" aria-hidden="true" tabindex="-1"></a><span class="in">    return(out)</span></span>
<span id="cb28-303"><a href="#cb28-303" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb28-304"><a href="#cb28-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-305"><a href="#cb28-305" aria-hidden="true" tabindex="-1"></a><span class="in"># if it has at least two adjacent 1 ("1-1" two flats) and the frequency change is equal or higher than 5 kHz it is a step</span></span>
<span id="cb28-306"><a href="#cb28-306" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$composed.subtype.label &lt;- sapply(seq_len(nrow(composed_anns)), function(x){</span></span>
<span id="cb28-307"><a href="#cb28-307" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-308"><a href="#cb28-308" aria-hidden="true" tabindex="-1"></a><span class="in">    if(sum(grepl("1-1", composed_anns$subtypes[x])) &amp; composed_anns$count.subtypes[x] == 2) {</span></span>
<span id="cb28-309"><a href="#cb28-309" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-310"><a href="#cb28-310" aria-hidden="true" tabindex="-1"></a><span class="in">        peakfs &lt;- anns$meanpeakf[anns$composed.subtype ==  composed_anns$composed.subtype[x]]</span></span>
<span id="cb28-311"><a href="#cb28-311" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-312"><a href="#cb28-312" aria-hidden="true" tabindex="-1"></a><span class="in">        diff_freq &lt;- abs(peakfs[1] - peakfs[2])</span></span>
<span id="cb28-313"><a href="#cb28-313" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb28-314"><a href="#cb28-314" aria-hidden="true" tabindex="-1"></a><span class="in">    out &lt;- if (diff_freq &gt;= 5) "step.flat" else </span></span>
<span id="cb28-315"><a href="#cb28-315" aria-hidden="true" tabindex="-1"></a><span class="in">        "composed.flat"    </span></span>
<span id="cb28-316"><a href="#cb28-316" aria-hidden="true" tabindex="-1"></a><span class="in">    } else out &lt;- composed_anns$composed.subtype.label[x]</span></span>
<span id="cb28-317"><a href="#cb28-317" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-318"><a href="#cb28-318" aria-hidden="true" tabindex="-1"></a><span class="in">    return(out)</span></span>
<span id="cb28-319"><a href="#cb28-319" aria-hidden="true" tabindex="-1"></a><span class="in">})</span></span>
<span id="cb28-320"><a href="#cb28-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-321"><a href="#cb28-321" aria-hidden="true" tabindex="-1"></a><span class="in">unique(composed_anns$subtypes[composed_anns$count.subtypes == 2 &amp; is.na(composed_anns$composed.subtype.label)])</span></span>
<span id="cb28-322"><a href="#cb28-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-323"><a href="#cb28-323" aria-hidden="true" tabindex="-1"></a><span class="in">round(table(composed_anns$composed.subtype.label)/ nrow(composed_anns), 2)</span></span>
<span id="cb28-324"><a href="#cb28-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-325"><a href="#cb28-325" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$subtype.label &lt;- ifelse(grepl("step", composed_anns$composed.subtype.label), "step", composed_anns$composed.subtype.label)</span></span>
<span id="cb28-326"><a href="#cb28-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-327"><a href="#cb28-327" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$subtype.label &lt;- ifelse(grepl("complex", composed_anns$composed.subtype.label), "complex", composed_anns$composed.subtype.label)</span></span>
<span id="cb28-328"><a href="#cb28-328" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-329"><a href="#cb28-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-330"><a href="#cb28-330" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$subtype.label &lt;- ifelse(grepl("composed.trill", composed_anns$composed.subtype.label), "trill", composed_anns$subtype.label)</span></span>
<span id="cb28-331"><a href="#cb28-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-332"><a href="#cb28-332" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(composed_anns, "./data/processed/annotations_composed_subtypes_5ms.csv", row.names = FALSE)</span></span>
<span id="cb28-333"><a href="#cb28-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-334"><a href="#cb28-334" aria-hidden="true" tabindex="-1"></a><span class="in">anns$type &lt;- "single"</span></span>
<span id="cb28-335"><a href="#cb28-335" aria-hidden="true" tabindex="-1"></a><span class="in">anns$composed.subtype.label &lt;- anns$subtype.label</span></span>
<span id="cb28-336"><a href="#cb28-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-337"><a href="#cb28-337" aria-hidden="true" tabindex="-1"></a><span class="in">composed_anns$type &lt;- "composed"</span></span>
<span id="cb28-338"><a href="#cb28-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-339"><a href="#cb28-339" aria-hidden="true" tabindex="-1"></a><span class="in">cols &lt;- intersect(colnames(anns), colnames(composed_anns))</span></span>
<span id="cb28-340"><a href="#cb28-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-341"><a href="#cb28-341" aria-hidden="true" tabindex="-1"></a><span class="in">combined_anns &lt;- rbind(anns[is.na(anns$ovlp.sels), cols], composed_anns[, cols])</span></span>
<span id="cb28-342"><a href="#cb28-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-343"><a href="#cb28-343" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(combined_anns, "./data/processed/annotations_simple_and_composed_subtypes_5ms.csv", row.names = FALSE)</span></span>
<span id="cb28-344"><a href="#cb28-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-345"><a href="#cb28-345" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-346"><a href="#cb28-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-347"><a href="#cb28-347" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary</span></span>
<span id="cb28-348"><a href="#cb28-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-349"><a href="#cb28-349" aria-hidden="true" tabindex="-1"></a>Proportion of calls per subtypes for composed (multi-element) subtypes</span>
<span id="cb28-352"><a href="#cb28-352" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-353"><a href="#cb28-353" aria-hidden="true" tabindex="-1"></a>composed_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb28-354"><a href="#cb28-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-355"><a href="#cb28-355" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>composed.subtype.label)<span class="sc">/</span> <span class="fu">nrow</span>(composed_anns), <span class="dv">2</span>)</span>
<span id="cb28-356"><a href="#cb28-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-357"><a href="#cb28-357" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb28-358"><a href="#cb28-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-359"><a href="#cb28-359" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb28-360"><a href="#cb28-360" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb28-361"><a href="#cb28-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-362"><a href="#cb28-362" aria-hidden="true" tabindex="-1"></a>count_types</span>
<span id="cb28-363"><a href="#cb28-363" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-364"><a href="#cb28-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-365"><a href="#cb28-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-366"><a href="#cb28-366" aria-hidden="true" tabindex="-1"></a>Combination of single element calls on each composed subtype</span>
<span id="cb28-367"><a href="#cb28-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-370"><a href="#cb28-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-371"><a href="#cb28-371" aria-hidden="true" tabindex="-1"></a>subtypes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1"</span> <span class="ot">=</span> <span class="st">"flat"</span>, <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"trill"</span>, <span class="st">"6"</span> <span class="ot">=</span> <span class="st">"complex"</span>, <span class="st">"22"</span> <span class="ot">=</span> <span class="st">"22 kHz"</span>)</span>
<span id="cb28-372"><a href="#cb28-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-373"><a href="#cb28-373" aria-hidden="true" tabindex="-1"></a>composed_anns<span class="sc">$</span>single.type.combs <span class="ot">&lt;-</span> composed_anns<span class="sc">$</span>subtypes</span>
<span id="cb28-374"><a href="#cb28-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-375"><a href="#cb28-375" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(subtypes))</span>
<span id="cb28-376"><a href="#cb28-376" aria-hidden="true" tabindex="-1"></a>    composed_anns<span class="sc">$</span>single.type.combs <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="fu">names</span>(subtypes)[i], subtypes[i], composed_anns<span class="sc">$</span>single.type.combs)  </span>
<span id="cb28-377"><a href="#cb28-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-378"><a href="#cb28-378" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>single.type.combs)<span class="sc">/</span> <span class="fu">nrow</span>(composed_anns), <span class="dv">2</span>)</span>
<span id="cb28-379"><a href="#cb28-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-380"><a href="#cb28-380" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb28-381"><a href="#cb28-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-382"><a href="#cb28-382" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(composed_anns<span class="sc">$</span>single.type.combs))</span>
<span id="cb28-383"><a href="#cb28-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-384"><a href="#cb28-384" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>comp <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Var1, <span class="cf">function</span>(x) composed_anns<span class="sc">$</span>composed.subtype.label[composed_anns<span class="sc">$</span>single.type.combs <span class="sc">==</span> x][<span class="dv">1</span>])</span>
<span id="cb28-385"><a href="#cb28-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-386"><a href="#cb28-386" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Single subtype combination"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>, <span class="st">"Composed subtype"</span>)</span>
<span id="cb28-387"><a href="#cb28-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-388"><a href="#cb28-388" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> count_types[<span class="fu">order</span>(count_types<span class="sc">$</span><span class="st">`</span><span class="at">Composed subtype</span><span class="st">`</span>), ]</span>
<span id="cb28-389"><a href="#cb28-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-390"><a href="#cb28-390" aria-hidden="true" tabindex="-1"></a>count_types[, <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>)]</span>
<span id="cb28-391"><a href="#cb28-391" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-392"><a href="#cb28-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-393"><a href="#cb28-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-394"><a href="#cb28-394" aria-hidden="true" tabindex="-1"></a>Proportion of calls per subtypes for both single and composed (multi-element) subtypes</span>
<span id="cb28-397"><a href="#cb28-397" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-398"><a href="#cb28-398" aria-hidden="true" tabindex="-1"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb28-399"><a href="#cb28-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-400"><a href="#cb28-400" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>subtype.label)<span class="sc">/</span> <span class="fu">nrow</span>(combined_anns), <span class="dv">2</span>)</span>
<span id="cb28-401"><a href="#cb28-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-402"><a href="#cb28-402" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb28-403"><a href="#cb28-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-404"><a href="#cb28-404" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>subtype.label))</span>
<span id="cb28-405"><a href="#cb28-405" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb28-406"><a href="#cb28-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-407"><a href="#cb28-407" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Subtype, <span class="cf">function</span>(x) <span class="fu">unique</span>(combined_anns<span class="sc">$</span>type[combined_anns<span class="sc">$</span>subtype.label <span class="sc">==</span> x]))</span>
<span id="cb28-408"><a href="#cb28-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-409"><a href="#cb28-409" aria-hidden="true" tabindex="-1"></a>count_types</span>
<span id="cb28-410"><a href="#cb28-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-411"><a href="#cb28-411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-412"><a href="#cb28-412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-413"><a href="#cb28-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-414"><a href="#cb28-414" aria-hidden="true" tabindex="-1"></a>Proportion of calls per subtypes for both single and composed by type (single vs composed)</span>
<span id="cb28-417"><a href="#cb28-417" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb28-418"><a href="#cb28-418" aria-hidden="true" tabindex="-1"></a>combined_anns <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"./data/processed/annotations_simple_and_composed_subtypes_5ms.csv"</span>)</span>
<span id="cb28-419"><a href="#cb28-419" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-420"><a href="#cb28-420" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>composed.subtype.label)<span class="sc">/</span> <span class="fu">nrow</span>(combined_anns), <span class="dv">2</span>)</span>
<span id="cb28-421"><a href="#cb28-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-422"><a href="#cb28-422" aria-hidden="true" tabindex="-1"></a>count_types <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(count_types)</span>
<span id="cb28-423"><a href="#cb28-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-424"><a href="#cb28-424" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>Count <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">table</span>(combined_anns<span class="sc">$</span>composed.subtype.label))</span>
<span id="cb28-425"><a href="#cb28-425" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(count_types) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Subtype"</span>, <span class="st">"Proportion"</span>, <span class="st">"Count"</span>)</span>
<span id="cb28-426"><a href="#cb28-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-427"><a href="#cb28-427" aria-hidden="true" tabindex="-1"></a>count_types<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="fu">sapply</span>(count_types<span class="sc">$</span>Subtype, <span class="cf">function</span>(x) <span class="fu">unique</span>(combined_anns<span class="sc">$</span>type[combined_anns<span class="sc">$</span>composed.subtype.label <span class="sc">==</span> x]))</span>
<span id="cb28-428"><a href="#cb28-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-429"><a href="#cb28-429" aria-hidden="true" tabindex="-1"></a>count_types</span>
<span id="cb28-430"><a href="#cb28-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-431"><a href="#cb28-431" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-432"><a href="#cb28-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-433"><a href="#cb28-433" aria-hidden="true" tabindex="-1"></a><span class="fu"># Create spectrograms</span></span>
<span id="cb28-434"><a href="#cb28-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-435"><a href="#cb28-435" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-436"><a href="#cb28-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-437"><a href="#cb28-437" aria-hidden="true" tabindex="-1"></a><span class="in">types &lt;- unique(combined_anns$subtype.label)</span></span>
<span id="cb28-438"><a href="#cb28-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-439"><a href="#cb28-439" aria-hidden="true" tabindex="-1"></a><span class="in">for (i in types[7:1]) {</span></span>
<span id="cb28-440"><a href="#cb28-440" aria-hidden="true" tabindex="-1"></a><span class="in">    print(i)</span></span>
<span id="cb28-441"><a href="#cb28-441" aria-hidden="true" tabindex="-1"></a><span class="in">    X &lt;- combined_anns[combined_anns$subtype.label == i,]</span></span>
<span id="cb28-442"><a href="#cb28-442" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-443"><a href="#cb28-443" aria-hidden="true" tabindex="-1"></a><span class="in">    # subset</span></span>
<span id="cb28-444"><a href="#cb28-444" aria-hidden="true" tabindex="-1"></a><span class="in">    set.seed(123)</span></span>
<span id="cb28-445"><a href="#cb28-445" aria-hidden="true" tabindex="-1"></a><span class="in">    if (nrow(X) &gt; 120)</span></span>
<span id="cb28-446"><a href="#cb28-446" aria-hidden="true" tabindex="-1"></a><span class="in">        X &lt;- X[sample(seq_len(nrow(X)), 120),]</span></span>
<span id="cb28-447"><a href="#cb28-447" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-448"><a href="#cb28-448" aria-hidden="true" tabindex="-1"></a><span class="in">    nrw &lt;- ncl &lt;- 2</span></span>
<span id="cb28-449"><a href="#cb28-449" aria-hidden="true" tabindex="-1"></a><span class="in">    n &lt;- nrow(X)</span></span>
<span id="cb28-450"><a href="#cb28-450" aria-hidden="true" tabindex="-1"></a><span class="in">    if (n &gt; 4) {</span></span>
<span id="cb28-451"><a href="#cb28-451" aria-hidden="true" tabindex="-1"></a><span class="in">        nrw &lt;- ncl &lt;- ceiling(sqrt(n))</span></span>
<span id="cb28-452"><a href="#cb28-452" aria-hidden="true" tabindex="-1"></a><span class="in">        if (((nrw - 1) * ncl) &gt;= n)</span></span>
<span id="cb28-453"><a href="#cb28-453" aria-hidden="true" tabindex="-1"></a><span class="in">            nrw &lt;- nrw - 1</span></span>
<span id="cb28-454"><a href="#cb28-454" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb28-455"><a href="#cb28-455" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-456"><a href="#cb28-456" aria-hidden="true" tabindex="-1"></a><span class="in">    # print catalog</span></span>
<span id="cb28-457"><a href="#cb28-457" aria-hidden="true" tabindex="-1"></a><span class="in">    catalog(</span></span>
<span id="cb28-458"><a href="#cb28-458" aria-hidden="true" tabindex="-1"></a><span class="in">        X = X,</span></span>
<span id="cb28-459"><a href="#cb28-459" aria-hidden="true" tabindex="-1"></a><span class="in">        nrow = nrw,</span></span>
<span id="cb28-460"><a href="#cb28-460" aria-hidden="true" tabindex="-1"></a><span class="in">        ncol = ncl,</span></span>
<span id="cb28-461"><a href="#cb28-461" aria-hidden="true" tabindex="-1"></a><span class="in">        same.time.scale = T,</span></span>
<span id="cb28-462"><a href="#cb28-462" aria-hidden="true" tabindex="-1"></a><span class="in">        mar = 0.001,</span></span>
<span id="cb28-463"><a href="#cb28-463" aria-hidden="true" tabindex="-1"></a><span class="in">        res = 100,</span></span>
<span id="cb28-464"><a href="#cb28-464" aria-hidden="true" tabindex="-1"></a><span class="in">        pb = FALSE,</span></span>
<span id="cb28-465"><a href="#cb28-465" aria-hidden="true" tabindex="-1"></a><span class="in">        spec.mar = 0.001,</span></span>
<span id="cb28-466"><a href="#cb28-466" aria-hidden="true" tabindex="-1"></a><span class="in">        max.group.cols = 5,</span></span>
<span id="cb28-467"><a href="#cb28-467" aria-hidden="true" tabindex="-1"></a><span class="in">        title = i,</span></span>
<span id="cb28-468"><a href="#cb28-468" aria-hidden="true" tabindex="-1"></a><span class="in">        ovlp = 50,</span></span>
<span id="cb28-469"><a href="#cb28-469" aria-hidden="true" tabindex="-1"></a><span class="in">        wl = 512,</span></span>
<span id="cb28-470"><a href="#cb28-470" aria-hidden="true" tabindex="-1"></a><span class="in">        width = 15,</span></span>
<span id="cb28-471"><a href="#cb28-471" aria-hidden="true" tabindex="-1"></a><span class="in">        height = 9,</span></span>
<span id="cb28-472"><a href="#cb28-472" aria-hidden="true" tabindex="-1"></a><span class="in">        hatching = 0,</span></span>
<span id="cb28-473"><a href="#cb28-473" aria-hidden="true" tabindex="-1"></a><span class="in">        cex = 1.3,</span></span>
<span id="cb28-474"><a href="#cb28-474" aria-hidden="true" tabindex="-1"></a><span class="in">        fast.spec = FALSE,</span></span>
<span id="cb28-475"><a href="#cb28-475" aria-hidden="true" tabindex="-1"></a><span class="in">        pal = viridis,</span></span>
<span id="cb28-476"><a href="#cb28-476" aria-hidden="true" tabindex="-1"></a><span class="in">        img.prefix = i,</span></span>
<span id="cb28-477"><a href="#cb28-477" aria-hidden="true" tabindex="-1"></a><span class="in">        rm.axes = TRUE,</span></span>
<span id="cb28-478"><a href="#cb28-478" aria-hidden="true" tabindex="-1"></a><span class="in">        flim = c(min(X$bottom.freq), max(X$top.freq)) + c(-1, 1),</span></span>
<span id="cb28-479"><a href="#cb28-479" aria-hidden="true" tabindex="-1"></a><span class="in">        alpha = 0.25,</span></span>
<span id="cb28-480"><a href="#cb28-480" aria-hidden="true" tabindex="-1"></a><span class="in">        collevels = seq(-120, 0, 5),</span></span>
<span id="cb28-481"><a href="#cb28-481" aria-hidden="true" tabindex="-1"></a><span class="in">        box = FALSE,</span></span>
<span id="cb28-482"><a href="#cb28-482" aria-hidden="true" tabindex="-1"></a><span class="in">        lab.mar = 0.00001</span></span>
<span id="cb28-483"><a href="#cb28-483" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-484"><a href="#cb28-484" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb28-485"><a href="#cb28-485" aria-hidden="true" tabindex="-1"></a><span class="in">    move_images(</span></span>
<span id="cb28-486"><a href="#cb28-486" aria-hidden="true" tabindex="-1"></a><span class="in">        from = .Options$warbleR$path,</span></span>
<span id="cb28-487"><a href="#cb28-487" aria-hidden="true" tabindex="-1"></a><span class="in">        to = "./output/catalogs",</span></span>
<span id="cb28-488"><a href="#cb28-488" aria-hidden="true" tabindex="-1"></a><span class="in">        overwrite = TRUE,</span></span>
<span id="cb28-489"><a href="#cb28-489" aria-hidden="true" tabindex="-1"></a><span class="in">        cut = TRUE,</span></span>
<span id="cb28-490"><a href="#cb28-490" aria-hidden="true" tabindex="-1"></a><span class="in">        pb = FALSE</span></span>
<span id="cb28-491"><a href="#cb28-491" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-492"><a href="#cb28-492" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb28-493"><a href="#cb28-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-494"><a href="#cb28-494" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-495"><a href="#cb28-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-496"><a href="#cb28-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-497"><a href="#cb28-497" aria-hidden="true" tabindex="-1"></a><span class="fu">## Single element subtypes</span></span>
<span id="cb28-498"><a href="#cb28-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-499"><a href="#cb28-499" aria-hidden="true" tabindex="-1"></a><span class="al">![Flat](flat-Catalog_p1.jpeg)</span></span>
<span id="cb28-500"><a href="#cb28-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-501"><a href="#cb28-501" aria-hidden="true" tabindex="-1"></a><span class="al">![Trill](trill-Catalog_p1.jpeg)</span></span>
<span id="cb28-502"><a href="#cb28-502" aria-hidden="true" tabindex="-1"></a><span class="al">![Complex](complex-Catalog_p1.jpeg)</span></span>
<span id="cb28-503"><a href="#cb28-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-504"><a href="#cb28-504" aria-hidden="true" tabindex="-1"></a><span class="fu">## Composed subtypes</span></span>
<span id="cb28-505"><a href="#cb28-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-506"><a href="#cb28-506" aria-hidden="true" tabindex="-1"></a><span class="al">![Step flat](step.flat-Catalog_p1.jpeg)</span></span>
<span id="cb28-507"><a href="#cb28-507" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-508"><a href="#cb28-508" aria-hidden="true" tabindex="-1"></a><span class="al">![Step trill](step.trill-Catalog_p1.jpeg)</span></span>
<span id="cb28-509"><a href="#cb28-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-510"><a href="#cb28-510" aria-hidden="true" tabindex="-1"></a><span class="al">![Step flat trill](step.flat.trill-Catalog_p1.jpeg)</span></span>
<span id="cb28-511"><a href="#cb28-511" aria-hidden="true" tabindex="-1"></a><span class="fu"># Random forest classification</span></span>
<span id="cb28-512"><a href="#cb28-512" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-513"><a href="#cb28-513" aria-hidden="true" tabindex="-1"></a>Models trained for 100 iterations on 75% of the data and tested on the remaining 25%.</span>
<span id="cb28-514"><a href="#cb28-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-515"><a href="#cb28-515" aria-hidden="true" tabindex="-1"></a><span class="fu">## On single element subtypes </span></span>
<span id="cb28-516"><a href="#cb28-516" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-517"><a href="#cb28-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-518"><a href="#cb28-518" aria-hidden="true" tabindex="-1"></a><span class="in">elm_anns &lt;- read.csv("./data/processed/annotations_groups_spectrogram_and_mel_features.csv")</span></span>
<span id="cb28-519"><a href="#cb28-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-520"><a href="#cb28-520" aria-hidden="true" tabindex="-1"></a><span class="in">elm_anns &lt;- elm_anns[elm_anns$subtype.label != "22", ]</span></span>
<span id="cb28-521"><a href="#cb28-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-522"><a href="#cb28-522" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-523"><a href="#cb28-523" aria-hidden="true" tabindex="-1"></a><span class="in"># remove collinear</span></span>
<span id="cb28-524"><a href="#cb28-524" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- names(elm_anns)[!names(elm_anns) %in%  c("sound.files", "selec", "View", "Channel", "start", "end", "bottom.freq", "top.freq", "Delta.Time..s.", "Begin.File", "subtipos", "selec.file", "true.end", "ovlp.sels", "composed.subtype", "subtype.label", names(elm_anns)[sapply(elm_anns, anyNA)])]</span></span>
<span id="cb28-525"><a href="#cb28-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-526"><a href="#cb28-526" aria-hidden="true" tabindex="-1"></a><span class="in">cormat &lt;- cor(elm_anns[, target_features], use = "pairwise.complete.obs")</span></span>
<span id="cb28-527"><a href="#cb28-527" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- findCorrelation(cormat, cutoff= 0.9) # putt any value as a "cutoff" </span></span>
<span id="cb28-528"><a href="#cb28-528" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- sort(hc)</span></span>
<span id="cb28-529"><a href="#cb28-529" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-530"><a href="#cb28-530" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- target_features[hc]</span></span>
<span id="cb28-531"><a href="#cb28-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-532"><a href="#cb28-532" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data subsets</span></span>
<span id="cb28-533"><a href="#cb28-533" aria-hidden="true" tabindex="-1"></a><span class="in">partition &lt;- createDataPartition(</span></span>
<span id="cb28-534"><a href="#cb28-534" aria-hidden="true" tabindex="-1"></a><span class="in">    y = elm_anns$subtype.label,</span></span>
<span id="cb28-535"><a href="#cb28-535" aria-hidden="true" tabindex="-1"></a><span class="in">    times = 1,</span></span>
<span id="cb28-536"><a href="#cb28-536" aria-hidden="true" tabindex="-1"></a><span class="in">    p = 0.75,</span></span>
<span id="cb28-537"><a href="#cb28-537" aria-hidden="true" tabindex="-1"></a><span class="in">    list = FALSE</span></span>
<span id="cb28-538"><a href="#cb28-538" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-539"><a href="#cb28-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-540"><a href="#cb28-540" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-541"><a href="#cb28-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-542"><a href="#cb28-542" aria-hidden="true" tabindex="-1"></a><span class="in">elm_anns$subtype.label &lt;- as.factor(elm_anns$subtype.label)</span></span>
<span id="cb28-543"><a href="#cb28-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-544"><a href="#cb28-544" aria-hidden="true" tabindex="-1"></a><span class="in">trainset &lt;- elm_anns[partition, c(target_features, "subtype.label")]</span></span>
<span id="cb28-545"><a href="#cb28-545" aria-hidden="true" tabindex="-1"></a><span class="in">testset &lt;- elm_anns[-partition, c(target_features, "subtype.label")]</span></span>
<span id="cb28-546"><a href="#cb28-546" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-547"><a href="#cb28-547" aria-hidden="true" tabindex="-1"></a><span class="in">trcontrol &lt;-</span></span>
<span id="cb28-548"><a href="#cb28-548" aria-hidden="true" tabindex="-1"></a><span class="in">    trainControl(</span></span>
<span id="cb28-549"><a href="#cb28-549" aria-hidden="true" tabindex="-1"></a><span class="in">        method = "repeatedcv",</span></span>
<span id="cb28-550"><a href="#cb28-550" aria-hidden="true" tabindex="-1"></a><span class="in">        number = 100,</span></span>
<span id="cb28-551"><a href="#cb28-551" aria-hidden="true" tabindex="-1"></a><span class="in">        repeats = 100,</span></span>
<span id="cb28-552"><a href="#cb28-552" aria-hidden="true" tabindex="-1"></a><span class="in">        savePredictions = TRUE,</span></span>
<span id="cb28-553"><a href="#cb28-553" aria-hidden="true" tabindex="-1"></a><span class="in">        sampling = "down",</span></span>
<span id="cb28-554"><a href="#cb28-554" aria-hidden="true" tabindex="-1"></a><span class="in">        classProbs = TRUE,</span></span>
<span id="cb28-555"><a href="#cb28-555" aria-hidden="true" tabindex="-1"></a><span class="in">        returnResamp = "all"</span></span>
<span id="cb28-556"><a href="#cb28-556" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-557"><a href="#cb28-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-558"><a href="#cb28-558" aria-hidden="true" tabindex="-1"></a><span class="in">pred_model &lt;- train(</span></span>
<span id="cb28-559"><a href="#cb28-559" aria-hidden="true" tabindex="-1"></a><span class="in">    subtype.label ~ .,</span></span>
<span id="cb28-560"><a href="#cb28-560" aria-hidden="true" tabindex="-1"></a><span class="in">    data = trainset,</span></span>
<span id="cb28-561"><a href="#cb28-561" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "rf",</span></span>
<span id="cb28-562"><a href="#cb28-562" aria-hidden="true" tabindex="-1"></a><span class="in">    trControl = trcontrol,</span></span>
<span id="cb28-563"><a href="#cb28-563" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "Accuracy",</span></span>
<span id="cb28-564"><a href="#cb28-564" aria-hidden="true" tabindex="-1"></a><span class="in">    preProcess = "scale"</span></span>
<span id="cb28-565"><a href="#cb28-565" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-566"><a href="#cb28-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-567"><a href="#cb28-567" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(pred_model) + theme_bw()</span></span>
<span id="cb28-568"><a href="#cb28-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-569"><a href="#cb28-569" aria-hidden="true" tabindex="-1"></a><span class="in"># save confusion matrix</span></span>
<span id="cb28-570"><a href="#cb28-570" aria-hidden="true" tabindex="-1"></a><span class="in">conf_mat &lt;-</span></span>
<span id="cb28-571"><a href="#cb28-571" aria-hidden="true" tabindex="-1"></a><span class="in">    confusionMatrix(predict(pred_model, testset), testset$subtype.label)</span></span>
<span id="cb28-572"><a href="#cb28-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-573"><a href="#cb28-573" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df &lt;- as.data.frame(conf_mat$table)</span></span>
<span id="cb28-574"><a href="#cb28-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-575"><a href="#cb28-575" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$total &lt;-</span></span>
<span id="cb28-576"><a href="#cb28-576" aria-hidden="true" tabindex="-1"></a><span class="in">    sapply(conf_df$Reference, function(x)</span></span>
<span id="cb28-577"><a href="#cb28-577" aria-hidden="true" tabindex="-1"></a><span class="in">        sum(testset$subtype.label ==</span></span>
<span id="cb28-578"><a href="#cb28-578" aria-hidden="true" tabindex="-1"></a><span class="in">                x))</span></span>
<span id="cb28-579"><a href="#cb28-579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-580"><a href="#cb28-580" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$proportion &lt;- conf_df$Freq / conf_df$total</span></span>
<span id="cb28-581"><a href="#cb28-581" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-582"><a href="#cb28-582" aria-hidden="true" tabindex="-1"></a><span class="in"># fit model on complete data set</span></span>
<span id="cb28-583"><a href="#cb28-583" aria-hidden="true" tabindex="-1"></a><span class="in">best_rf_model &lt;- pred_model$finalModel</span></span>
<span id="cb28-584"><a href="#cb28-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-585"><a href="#cb28-585" aria-hidden="true" tabindex="-1"></a><span class="in"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb28-586"><a href="#cb28-586" aria-hidden="true" tabindex="-1"></a><span class="in">#   subtype.label ~ .,</span></span>
<span id="cb28-587"><a href="#cb28-587" aria-hidden="true" tabindex="-1"></a><span class="in">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb28-588"><a href="#cb28-588" aria-hidden="true" tabindex="-1"></a><span class="in">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb28-589"><a href="#cb28-589" aria-hidden="true" tabindex="-1"></a><span class="in">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb28-590"><a href="#cb28-590" aria-hidden="true" tabindex="-1"></a><span class="in">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb28-591"><a href="#cb28-591" aria-hidden="true" tabindex="-1"></a><span class="in">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb28-592"><a href="#cb28-592" aria-hidden="true" tabindex="-1"></a><span class="in">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb28-593"><a href="#cb28-593" aria-hidden="true" tabindex="-1"></a><span class="in"># )</span></span>
<span id="cb28-594"><a href="#cb28-594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-595"><a href="#cb28-595" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-596"><a href="#cb28-596" aria-hidden="true" tabindex="-1"></a><span class="in">    list(</span></span>
<span id="cb28-597"><a href="#cb28-597" aria-hidden="true" tabindex="-1"></a><span class="in">        pred_model_bb = pred_model,</span></span>
<span id="cb28-598"><a href="#cb28-598" aria-hidden="true" tabindex="-1"></a><span class="in">        conf_mat_bb = conf_mat,</span></span>
<span id="cb28-599"><a href="#cb28-599" aria-hidden="true" tabindex="-1"></a><span class="in">        confusion_df_bb = conf_df,</span></span>
<span id="cb28-600"><a href="#cb28-600" aria-hidden="true" tabindex="-1"></a><span class="in">        testset_bb = testset</span></span>
<span id="cb28-601"><a href="#cb28-601" aria-hidden="true" tabindex="-1"></a><span class="in">        #all_rf_model = all_rf_model</span></span>
<span id="cb28-602"><a href="#cb28-602" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-603"><a href="#cb28-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-604"><a href="#cb28-604" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-605"><a href="#cb28-605" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(</span></span>
<span id="cb28-606"><a href="#cb28-606" aria-hidden="true" tabindex="-1"></a><span class="in">    rf_model_results,</span></span>
<span id="cb28-607"><a href="#cb28-607" aria-hidden="true" tabindex="-1"></a><span class="in">    "./data/processed/random_forest_model_results.RDS"</span></span>
<span id="cb28-608"><a href="#cb28-608" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-609"><a href="#cb28-609" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-610"><a href="#cb28-610" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-611"><a href="#cb28-611" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-612"><a href="#cb28-612" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking performance on test data</span></span>
<span id="cb28-613"><a href="#cb28-613" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb28-614"><a href="#cb28-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-615"><a href="#cb28-615" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-616"><a href="#cb28-616" aria-hidden="true" tabindex="-1"></a><span class="in">    readRDS("./data/processed/random_forest_model_results.RDS")</span></span>
<span id="cb28-617"><a href="#cb28-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-618"><a href="#cb28-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-619"><a href="#cb28-619" aria-hidden="true" tabindex="-1"></a><span class="in"># print confusion matrix results</span></span>
<span id="cb28-620"><a href="#cb28-620" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results$conf_mat_bb</span></span>
<span id="cb28-621"><a href="#cb28-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-622"><a href="#cb28-622" aria-hidden="true" tabindex="-1"></a><span class="in">confusion_df &lt;- rf_model_results$confusion_df_bb</span></span>
<span id="cb28-623"><a href="#cb28-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-624"><a href="#cb28-624" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(confusion_df, aes(x = Reference, y = Prediction, fill = proportion)) +</span></span>
<span id="cb28-625"><a href="#cb28-625" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_tile() +</span></span>
<span id="cb28-626"><a href="#cb28-626" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_equal() +</span></span>
<span id="cb28-627"><a href="#cb28-627" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_distiller(palette = "Greens", direction = 1) +</span></span>
<span id="cb28-628"><a href="#cb28-628" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = round(proportion, 2)), color = "black", size = 3) +</span></span>
<span id="cb28-629"><a href="#cb28-629" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() +</span></span>
<span id="cb28-630"><a href="#cb28-630" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Observed", y = "Predicted") +</span></span>
<span id="cb28-631"><a href="#cb28-631" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_text(</span></span>
<span id="cb28-632"><a href="#cb28-632" aria-hidden="true" tabindex="-1"></a><span class="in">        color = "black",</span></span>
<span id="cb28-633"><a href="#cb28-633" aria-hidden="true" tabindex="-1"></a><span class="in">        size = 11,</span></span>
<span id="cb28-634"><a href="#cb28-634" aria-hidden="true" tabindex="-1"></a><span class="in">        angle = 30,</span></span>
<span id="cb28-635"><a href="#cb28-635" aria-hidden="true" tabindex="-1"></a><span class="in">        vjust = 0.8,</span></span>
<span id="cb28-636"><a href="#cb28-636" aria-hidden="true" tabindex="-1"></a><span class="in">        hjust = 0.8</span></span>
<span id="cb28-637"><a href="#cb28-637" aria-hidden="true" tabindex="-1"></a><span class="in">    ))</span></span>
<span id="cb28-638"><a href="#cb28-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-639"><a href="#cb28-639" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-640"><a href="#cb28-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-641"><a href="#cb28-641" aria-hidden="true" tabindex="-1"></a><span class="fu">## On composed (multi-element) subtypes </span></span>
<span id="cb28-642"><a href="#cb28-642" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-643"><a href="#cb28-643" aria-hidden="true" tabindex="-1"></a>Summarize structure at the multi-element subtype level</span>
<span id="cb28-644"><a href="#cb28-644" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-645"><a href="#cb28-645" aria-hidden="true" tabindex="-1"></a><span class="in">elm_anns &lt;- read.csv("./data/processed/annotations_groups_spectrogram_and_mel_features.csv")</span></span>
<span id="cb28-646"><a href="#cb28-646" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-647"><a href="#cb28-647" aria-hidden="true" tabindex="-1"></a><span class="in">mean_colms &lt;- c("duration", "meanfreq", "sd", "freq.median", "freq.Q25",  "freq.Q75",  "freq.IQR", "time.median", "time.Q25",  "time.Q75",  "time.IQR", "skew", "kurt", "sp.ent", "time.ent", "entropy", "sfm", "meandom", "mindom", "maxdom", "dfrange", "modindx", "startdom", "enddom",    "dfslope",   "meanpeakf", "min.cc1", "min.cc2",   "min.cc3",   "min.cc4",   "min.cc5", "min.cc6",   "min.cc7",   "min.cc8",   "min.cc9", "min.cc10",  "min.cc11",  "min.cc12",  "min.cc13", "min.cc14",  "min.cc15",  "min.cc16",  "min.cc17", "min.cc18", "min.cc19",  "min.cc20",  "min.cc21", "min.cc22",  "min.cc23",  "min.cc24",  "min.cc25", "max.cc1",   "max.cc2",   "max.cc3",   "max.cc4", "max.cc5",   "max.cc6",   "max.cc7",   "max.cc8", "max.cc9",   "max.cc10",  "max.cc11",  "max.cc12", "max.cc13",  "max.cc14",  "max.cc15",  "max.cc16", "max.cc17",  "max.cc18",  "max.cc19",  "max.cc20", "max.cc21",  "max.cc22",  "max.cc23",  "max.cc24", "max.cc25",  "median.cc1", "median.cc2", "median.cc3", "median.cc4", "median.cc5", "median.cc6", "median.cc7", "median.cc8", "median.cc9", "median.cc10", "median.cc11", "median.cc12", "median.cc13", "median.cc14", "median.cc15", "median.cc16", "median.cc17", "median.cc18", "median.cc19", "median.cc20", "median.cc21", "median.cc22", "median.cc23", "median.cc24", "median.cc25", "mean.cc1",  "mean.cc2", "mean.cc3",  "mean.cc4",  "mean.cc5",  "mean.cc6", "mean.cc7",  "mean.cc8",  "mean.cc9",  "mean.cc10", "mean.cc11", "mean.cc12", "mean.cc13", "mean.cc14",  "mean.cc15", "mean.cc16", "mean.cc17", "mean.cc18", "mean.cc19", "mean.cc20", "mean.cc21", "mean.cc22", "mean.cc23", "mean.cc24", "mean.cc25", "var.cc1", "var.cc2",   "var.cc3",   "var.cc4",   "var.cc5", "var.cc6",   "var.cc7",   "var.cc8",   "var.cc9", "var.cc10",  "var.cc11",  "var.cc12",  "var.cc13", "var.cc14",  "var.cc15",  "var.cc16",  "var.cc17", "var.cc18",  "var.cc19",  "var.cc20",  "var.cc21", "var.cc22",  "var.cc23",  "var.cc24",  "var.cc25", "skew.cc1",  "skew.cc2",  "skew.cc3",  "skew.cc4", "skew.cc5",  "skew.cc6",  "skew.cc7",  "skew.cc8", "skew.cc9",  "skew.cc10", "skew.cc11", "skew.cc12", "skew.cc13", "skew.cc14", "skew.cc15", "skew.cc16", "skew.cc17", "skew.cc18", "skew.cc19", "skew.cc20", "skew.cc21", "skew.cc22", "skew.cc23", "skew.cc24", "skew.cc25", "kurt.cc1",  "kurt.cc2",  "kurt.cc3", "kurt.cc4",  "kurt.cc5",  "kurt.cc6",  "kurt.cc7", "kurt.cc8",  "kurt.cc9",  "kurt.cc10", "kurt.cc11",  "kurt.cc12", "kurt.cc13", "kurt.cc14", "kurt.cc15", "kurt.cc16", "kurt.cc17", "kurt.cc18", "kurt.cc19", "kurt.cc20", "kurt.cc21", "kurt.cc22", "kurt.cc23", "kurt.cc24", "kurt.cc25", "mean.d1.cc", "var.d1.cc", "mean.d2.cc", "var.d2.cc")  </span></span>
<span id="cb28-648"><a href="#cb28-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-649"><a href="#cb28-649" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param &lt;- song_param(X = elm_anns, song_colm = "composed.subtype", mean_colm = mean_colms)</span></span>
<span id="cb28-650"><a href="#cb28-650" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-651"><a href="#cb28-651" aria-hidden="true" tabindex="-1"></a><span class="in">combined_anns &lt;- read.csv("./data/processed/annotations_simple_and_composed_subtypes_5ms.csv")</span></span>
<span id="cb28-652"><a href="#cb28-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-653"><a href="#cb28-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-654"><a href="#cb28-654" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param$composed.subtype.label &lt;- sapply(composed_param$composed.subtype, function(x) unique(combined_anns$composed.subtype.label[combined_anns$composed.subtype == x]))</span></span>
<span id="cb28-655"><a href="#cb28-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-656"><a href="#cb28-656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-657"><a href="#cb28-657" aria-hidden="true" tabindex="-1"></a><span class="in">write.csv(composed_param, "./data/processed/accoustic_features_simple_and_composed_subtypes.csv", row.names = FALSE)</span></span>
<span id="cb28-658"><a href="#cb28-658" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-659"><a href="#cb28-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-660"><a href="#cb28-660" aria-hidden="true" tabindex="-1"></a><span class="fu">### Train model</span></span>
<span id="cb28-661"><a href="#cb28-661" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-662"><a href="#cb28-662" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-663"><a href="#cb28-663" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param &lt;- read.csv("./data/processed/accoustic_features_simple_and_composed_subtypes.csv")</span></span>
<span id="cb28-664"><a href="#cb28-664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-665"><a href="#cb28-665" aria-hidden="true" tabindex="-1"></a><span class="in"># keep only multi-element</span></span>
<span id="cb28-666"><a href="#cb28-666" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param &lt;- composed_param[composed_param$num.elms &gt; 1, ]</span></span>
<span id="cb28-667"><a href="#cb28-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-668"><a href="#cb28-668" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param$song.rate[is.infinite(composed_param$song.rate)] &lt;- mean(composed_param$song.rate[!is.infinite(composed_param$song.rate)])</span></span>
<span id="cb28-669"><a href="#cb28-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-670"><a href="#cb28-670" aria-hidden="true" tabindex="-1"></a><span class="in"># remove collinear</span></span>
<span id="cb28-671"><a href="#cb28-671" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- names(composed_param)[!names(composed_param) %in%  c("sound.files", "selec", "View", "Channel", "start", "end", "bottom.freq", "top.freq", "Delta.Time..s.", "Begin.File", "subtipos", "selec.file", "true.end", "ovlp.sels", "composed.subtype", "subtype.label", "composed.subtype.label", names(composed_param)[sapply(composed_param, anyNA)])]</span></span>
<span id="cb28-672"><a href="#cb28-672" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-673"><a href="#cb28-673" aria-hidden="true" tabindex="-1"></a><span class="in">cormat &lt;- cor(composed_param[, target_features], use = "pairwise.complete.obs")</span></span>
<span id="cb28-674"><a href="#cb28-674" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- findCorrelation(cormat, cutoff= 0.9) # putt any value as a "cutoff" </span></span>
<span id="cb28-675"><a href="#cb28-675" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- sort(hc)</span></span>
<span id="cb28-676"><a href="#cb28-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-677"><a href="#cb28-677" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- target_features[hc]</span></span>
<span id="cb28-678"><a href="#cb28-678" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-679"><a href="#cb28-679" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data subsets</span></span>
<span id="cb28-680"><a href="#cb28-680" aria-hidden="true" tabindex="-1"></a><span class="in">partition &lt;- createDataPartition(</span></span>
<span id="cb28-681"><a href="#cb28-681" aria-hidden="true" tabindex="-1"></a><span class="in">    y = composed_param$composed.subtype.label,</span></span>
<span id="cb28-682"><a href="#cb28-682" aria-hidden="true" tabindex="-1"></a><span class="in">    times = 1,</span></span>
<span id="cb28-683"><a href="#cb28-683" aria-hidden="true" tabindex="-1"></a><span class="in">    p = 0.75,</span></span>
<span id="cb28-684"><a href="#cb28-684" aria-hidden="true" tabindex="-1"></a><span class="in">    list = FALSE</span></span>
<span id="cb28-685"><a href="#cb28-685" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-686"><a href="#cb28-686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-687"><a href="#cb28-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-688"><a href="#cb28-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-689"><a href="#cb28-689" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param$composed_param$composed.subtype.label &lt;- as.factor(composed_param$composed.subtype.label)</span></span>
<span id="cb28-690"><a href="#cb28-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-691"><a href="#cb28-691" aria-hidden="true" tabindex="-1"></a><span class="in">trainset &lt;- composed_param[partition, c(target_features, "composed.subtype.label")]</span></span>
<span id="cb28-692"><a href="#cb28-692" aria-hidden="true" tabindex="-1"></a><span class="in">testset &lt;- composed_param[-partition, c(target_features, "composed.subtype.label")]</span></span>
<span id="cb28-693"><a href="#cb28-693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-694"><a href="#cb28-694" aria-hidden="true" tabindex="-1"></a><span class="in">trcontrol &lt;-</span></span>
<span id="cb28-695"><a href="#cb28-695" aria-hidden="true" tabindex="-1"></a><span class="in">    trainControl(</span></span>
<span id="cb28-696"><a href="#cb28-696" aria-hidden="true" tabindex="-1"></a><span class="in">        method = "repeatedcv",</span></span>
<span id="cb28-697"><a href="#cb28-697" aria-hidden="true" tabindex="-1"></a><span class="in">        number = 100,</span></span>
<span id="cb28-698"><a href="#cb28-698" aria-hidden="true" tabindex="-1"></a><span class="in">        repeats = 100,</span></span>
<span id="cb28-699"><a href="#cb28-699" aria-hidden="true" tabindex="-1"></a><span class="in">        savePredictions = TRUE,</span></span>
<span id="cb28-700"><a href="#cb28-700" aria-hidden="true" tabindex="-1"></a><span class="in">        sampling = "down",</span></span>
<span id="cb28-701"><a href="#cb28-701" aria-hidden="true" tabindex="-1"></a><span class="in">        classProbs = TRUE,</span></span>
<span id="cb28-702"><a href="#cb28-702" aria-hidden="true" tabindex="-1"></a><span class="in">        returnResamp = "all"</span></span>
<span id="cb28-703"><a href="#cb28-703" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-704"><a href="#cb28-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-705"><a href="#cb28-705" aria-hidden="true" tabindex="-1"></a><span class="in">pred_model &lt;- train(</span></span>
<span id="cb28-706"><a href="#cb28-706" aria-hidden="true" tabindex="-1"></a><span class="in">    composed.subtype.label ~ .,</span></span>
<span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a><span class="in">    data = trainset,</span></span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "rf",</span></span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a><span class="in">    trControl = trcontrol,</span></span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "Accuracy",</span></span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a><span class="in">    preProcess = "scale"</span></span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-713"><a href="#cb28-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-714"><a href="#cb28-714" aria-hidden="true" tabindex="-1"></a><span class="in"># ggplot(pred_model) + theme_bw()</span></span>
<span id="cb28-715"><a href="#cb28-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-716"><a href="#cb28-716" aria-hidden="true" tabindex="-1"></a><span class="in"># save confusion matrix</span></span>
<span id="cb28-717"><a href="#cb28-717" aria-hidden="true" tabindex="-1"></a><span class="in">conf_mat &lt;-</span></span>
<span id="cb28-718"><a href="#cb28-718" aria-hidden="true" tabindex="-1"></a><span class="in">    confusionMatrix(predict(pred_model, testset), as.factor(testset$composed.subtype.label))</span></span>
<span id="cb28-719"><a href="#cb28-719" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-720"><a href="#cb28-720" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df &lt;- as.data.frame(conf_mat$table)</span></span>
<span id="cb28-721"><a href="#cb28-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-722"><a href="#cb28-722" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$total &lt;-</span></span>
<span id="cb28-723"><a href="#cb28-723" aria-hidden="true" tabindex="-1"></a><span class="in">    sapply(conf_df$Reference, function(x)</span></span>
<span id="cb28-724"><a href="#cb28-724" aria-hidden="true" tabindex="-1"></a><span class="in">        sum(testset$composed.subtype.label ==</span></span>
<span id="cb28-725"><a href="#cb28-725" aria-hidden="true" tabindex="-1"></a><span class="in">                x))</span></span>
<span id="cb28-726"><a href="#cb28-726" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-727"><a href="#cb28-727" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$proportion &lt;- conf_df$Freq / conf_df$total</span></span>
<span id="cb28-728"><a href="#cb28-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-729"><a href="#cb28-729" aria-hidden="true" tabindex="-1"></a><span class="in"># fit model on complete data set</span></span>
<span id="cb28-730"><a href="#cb28-730" aria-hidden="true" tabindex="-1"></a><span class="in">best_rf_model &lt;- pred_model$finalModel</span></span>
<span id="cb28-731"><a href="#cb28-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-732"><a href="#cb28-732" aria-hidden="true" tabindex="-1"></a><span class="in"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb28-733"><a href="#cb28-733" aria-hidden="true" tabindex="-1"></a><span class="in">#   subtype.label ~ .,</span></span>
<span id="cb28-734"><a href="#cb28-734" aria-hidden="true" tabindex="-1"></a><span class="in">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb28-735"><a href="#cb28-735" aria-hidden="true" tabindex="-1"></a><span class="in">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb28-736"><a href="#cb28-736" aria-hidden="true" tabindex="-1"></a><span class="in">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb28-737"><a href="#cb28-737" aria-hidden="true" tabindex="-1"></a><span class="in">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb28-738"><a href="#cb28-738" aria-hidden="true" tabindex="-1"></a><span class="in">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb28-739"><a href="#cb28-739" aria-hidden="true" tabindex="-1"></a><span class="in">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb28-740"><a href="#cb28-740" aria-hidden="true" tabindex="-1"></a><span class="in"># )</span></span>
<span id="cb28-741"><a href="#cb28-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-742"><a href="#cb28-742" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-743"><a href="#cb28-743" aria-hidden="true" tabindex="-1"></a><span class="in">    list(</span></span>
<span id="cb28-744"><a href="#cb28-744" aria-hidden="true" tabindex="-1"></a><span class="in">        pred_model_bb = pred_model,</span></span>
<span id="cb28-745"><a href="#cb28-745" aria-hidden="true" tabindex="-1"></a><span class="in">        conf_mat_bb = conf_mat,</span></span>
<span id="cb28-746"><a href="#cb28-746" aria-hidden="true" tabindex="-1"></a><span class="in">        confusion_df_bb = conf_df,</span></span>
<span id="cb28-747"><a href="#cb28-747" aria-hidden="true" tabindex="-1"></a><span class="in">        testset_bb = testset</span></span>
<span id="cb28-748"><a href="#cb28-748" aria-hidden="true" tabindex="-1"></a><span class="in">        #all_rf_model = all_rf_model</span></span>
<span id="cb28-749"><a href="#cb28-749" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-750"><a href="#cb28-750" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-751"><a href="#cb28-751" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(</span></span>
<span id="cb28-752"><a href="#cb28-752" aria-hidden="true" tabindex="-1"></a><span class="in">    rf_model_results,</span></span>
<span id="cb28-753"><a href="#cb28-753" aria-hidden="true" tabindex="-1"></a><span class="in">    "./data/processed/random_forest_model_results_composed_subtypes.RDS"</span></span>
<span id="cb28-754"><a href="#cb28-754" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-755"><a href="#cb28-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-756"><a href="#cb28-756" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-757"><a href="#cb28-757" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-758"><a href="#cb28-758" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking performance on test data</span></span>
<span id="cb28-759"><a href="#cb28-759" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb28-760"><a href="#cb28-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-761"><a href="#cb28-761" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-762"><a href="#cb28-762" aria-hidden="true" tabindex="-1"></a><span class="in">    readRDS("./data/processed/random_forest_model_results_composed_subtypes.RDS")</span></span>
<span id="cb28-763"><a href="#cb28-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-764"><a href="#cb28-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-765"><a href="#cb28-765" aria-hidden="true" tabindex="-1"></a><span class="in"># print confusion matrix results</span></span>
<span id="cb28-766"><a href="#cb28-766" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results$conf_mat_bb</span></span>
<span id="cb28-767"><a href="#cb28-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-768"><a href="#cb28-768" aria-hidden="true" tabindex="-1"></a><span class="in">confusion_df &lt;- rf_model_results$confusion_df_bb</span></span>
<span id="cb28-769"><a href="#cb28-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-770"><a href="#cb28-770" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(confusion_df, aes(x = Reference, y = Prediction, fill = proportion)) +</span></span>
<span id="cb28-771"><a href="#cb28-771" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_tile() +</span></span>
<span id="cb28-772"><a href="#cb28-772" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_equal() +</span></span>
<span id="cb28-773"><a href="#cb28-773" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_distiller(palette = "Greens", direction = 1) +</span></span>
<span id="cb28-774"><a href="#cb28-774" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = round(proportion, 2)), color = "black", size = 3) +</span></span>
<span id="cb28-775"><a href="#cb28-775" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() +</span></span>
<span id="cb28-776"><a href="#cb28-776" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Observed", y = "Predicted") +</span></span>
<span id="cb28-777"><a href="#cb28-777" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_text(</span></span>
<span id="cb28-778"><a href="#cb28-778" aria-hidden="true" tabindex="-1"></a><span class="in">        color = "black",</span></span>
<span id="cb28-779"><a href="#cb28-779" aria-hidden="true" tabindex="-1"></a><span class="in">        size = 11,</span></span>
<span id="cb28-780"><a href="#cb28-780" aria-hidden="true" tabindex="-1"></a><span class="in">        angle = 30,</span></span>
<span id="cb28-781"><a href="#cb28-781" aria-hidden="true" tabindex="-1"></a><span class="in">        vjust = 0.8,</span></span>
<span id="cb28-782"><a href="#cb28-782" aria-hidden="true" tabindex="-1"></a><span class="in">        hjust = 0.8</span></span>
<span id="cb28-783"><a href="#cb28-783" aria-hidden="true" tabindex="-1"></a><span class="in">    ))</span></span>
<span id="cb28-784"><a href="#cb28-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-785"><a href="#cb28-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-786"><a href="#cb28-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-787"><a href="#cb28-787" aria-hidden="true" tabindex="-1"></a><span class="fu">## On single and composed (multi-element) subtypes </span></span>
<span id="cb28-788"><a href="#cb28-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-789"><a href="#cb28-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Train model</span></span>
<span id="cb28-790"><a href="#cb28-790" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb28-791"><a href="#cb28-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-792"><a href="#cb28-792" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param &lt;- read.csv("./data/processed/accoustic_features_simple_and_composed_subtypes.csv")</span></span>
<span id="cb28-793"><a href="#cb28-793" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-794"><a href="#cb28-794" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param &lt;- composed_param[composed_param$composed.subtype.label != "22 kHz", ]</span></span>
<span id="cb28-795"><a href="#cb28-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-796"><a href="#cb28-796" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param$song.rate[is.infinite(composed_param$song.rate)] &lt;- mean(composed_param$song.rate[!is.infinite(composed_param$song.rate)])</span></span>
<span id="cb28-797"><a href="#cb28-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-798"><a href="#cb28-798" aria-hidden="true" tabindex="-1"></a><span class="in"># remove collinear</span></span>
<span id="cb28-799"><a href="#cb28-799" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- names(composed_param)[!names(composed_param) %in%  c("sound.files", "selec", "View", "Channel", "start", "end", "bottom.freq", "top.freq", "Delta.Time..s.", "Begin.File", "subtipos", "selec.file", "true.end", "ovlp.sels", "composed.subtype", "subtype.label", "composed.subtype.label" , "song.rate", names(composed_param)[sapply(composed_param, anyNA)])]</span></span>
<span id="cb28-800"><a href="#cb28-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-801"><a href="#cb28-801" aria-hidden="true" tabindex="-1"></a><span class="in">cormat &lt;- cor(composed_param[, target_features], use = "pairwise.complete.obs")</span></span>
<span id="cb28-802"><a href="#cb28-802" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- findCorrelation(cormat, cutoff= 0.9) # putt any value as a "cutoff" </span></span>
<span id="cb28-803"><a href="#cb28-803" aria-hidden="true" tabindex="-1"></a><span class="in">hc &lt;- sort(hc)</span></span>
<span id="cb28-804"><a href="#cb28-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-805"><a href="#cb28-805" aria-hidden="true" tabindex="-1"></a><span class="in">target_features &lt;- target_features[hc]</span></span>
<span id="cb28-806"><a href="#cb28-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-807"><a href="#cb28-807" aria-hidden="true" tabindex="-1"></a><span class="in"># Create data subsets</span></span>
<span id="cb28-808"><a href="#cb28-808" aria-hidden="true" tabindex="-1"></a><span class="in">partition &lt;- createDataPartition(</span></span>
<span id="cb28-809"><a href="#cb28-809" aria-hidden="true" tabindex="-1"></a><span class="in">    y = composed_param$composed.subtype.label,</span></span>
<span id="cb28-810"><a href="#cb28-810" aria-hidden="true" tabindex="-1"></a><span class="in">    times = 1,</span></span>
<span id="cb28-811"><a href="#cb28-811" aria-hidden="true" tabindex="-1"></a><span class="in">    p = 0.75,</span></span>
<span id="cb28-812"><a href="#cb28-812" aria-hidden="true" tabindex="-1"></a><span class="in">    list = FALSE</span></span>
<span id="cb28-813"><a href="#cb28-813" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-814"><a href="#cb28-814" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-815"><a href="#cb28-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-816"><a href="#cb28-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-817"><a href="#cb28-817" aria-hidden="true" tabindex="-1"></a><span class="in">composed_param$composed_param$composed.subtype.label &lt;- as.factor(composed_param$composed.subtype.label)</span></span>
<span id="cb28-818"><a href="#cb28-818" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-819"><a href="#cb28-819" aria-hidden="true" tabindex="-1"></a><span class="in">trainset &lt;- composed_param[partition, c(target_features, "composed.subtype.label")]</span></span>
<span id="cb28-820"><a href="#cb28-820" aria-hidden="true" tabindex="-1"></a><span class="in">testset &lt;- composed_param[-partition, c(target_features, "composed.subtype.label")]</span></span>
<span id="cb28-821"><a href="#cb28-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-822"><a href="#cb28-822" aria-hidden="true" tabindex="-1"></a><span class="in">trcontrol &lt;-</span></span>
<span id="cb28-823"><a href="#cb28-823" aria-hidden="true" tabindex="-1"></a><span class="in">    trainControl(</span></span>
<span id="cb28-824"><a href="#cb28-824" aria-hidden="true" tabindex="-1"></a><span class="in">        method = "repeatedcv",</span></span>
<span id="cb28-825"><a href="#cb28-825" aria-hidden="true" tabindex="-1"></a><span class="in">        number = 100,</span></span>
<span id="cb28-826"><a href="#cb28-826" aria-hidden="true" tabindex="-1"></a><span class="in">        repeats = 100,</span></span>
<span id="cb28-827"><a href="#cb28-827" aria-hidden="true" tabindex="-1"></a><span class="in">        savePredictions = TRUE,</span></span>
<span id="cb28-828"><a href="#cb28-828" aria-hidden="true" tabindex="-1"></a><span class="in">        sampling = "down",</span></span>
<span id="cb28-829"><a href="#cb28-829" aria-hidden="true" tabindex="-1"></a><span class="in">        classProbs = TRUE,</span></span>
<span id="cb28-830"><a href="#cb28-830" aria-hidden="true" tabindex="-1"></a><span class="in">        returnResamp = "all"</span></span>
<span id="cb28-831"><a href="#cb28-831" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-832"><a href="#cb28-832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-833"><a href="#cb28-833" aria-hidden="true" tabindex="-1"></a><span class="in">pred_model &lt;- train(</span></span>
<span id="cb28-834"><a href="#cb28-834" aria-hidden="true" tabindex="-1"></a><span class="in">    composed.subtype.label ~ .,</span></span>
<span id="cb28-835"><a href="#cb28-835" aria-hidden="true" tabindex="-1"></a><span class="in">    data = trainset,</span></span>
<span id="cb28-836"><a href="#cb28-836" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "rf",</span></span>
<span id="cb28-837"><a href="#cb28-837" aria-hidden="true" tabindex="-1"></a><span class="in">    trControl = trcontrol,</span></span>
<span id="cb28-838"><a href="#cb28-838" aria-hidden="true" tabindex="-1"></a><span class="in">    metric = "Accuracy",</span></span>
<span id="cb28-839"><a href="#cb28-839" aria-hidden="true" tabindex="-1"></a><span class="in">    preProcess = "scale"</span></span>
<span id="cb28-840"><a href="#cb28-840" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-841"><a href="#cb28-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-842"><a href="#cb28-842" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(pred_model) + theme_bw()</span></span>
<span id="cb28-843"><a href="#cb28-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-844"><a href="#cb28-844" aria-hidden="true" tabindex="-1"></a><span class="in"># save confusion matrix</span></span>
<span id="cb28-845"><a href="#cb28-845" aria-hidden="true" tabindex="-1"></a><span class="in">conf_mat &lt;-</span></span>
<span id="cb28-846"><a href="#cb28-846" aria-hidden="true" tabindex="-1"></a><span class="in">    confusionMatrix(predict(pred_model, testset), as.factor(testset$composed.subtype.label))</span></span>
<span id="cb28-847"><a href="#cb28-847" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-848"><a href="#cb28-848" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df &lt;- as.data.frame(conf_mat$table)</span></span>
<span id="cb28-849"><a href="#cb28-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-850"><a href="#cb28-850" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$total &lt;-</span></span>
<span id="cb28-851"><a href="#cb28-851" aria-hidden="true" tabindex="-1"></a><span class="in">    sapply(conf_df$Reference, function(x)</span></span>
<span id="cb28-852"><a href="#cb28-852" aria-hidden="true" tabindex="-1"></a><span class="in">        sum(testset$composed.subtype.label ==</span></span>
<span id="cb28-853"><a href="#cb28-853" aria-hidden="true" tabindex="-1"></a><span class="in">                x))</span></span>
<span id="cb28-854"><a href="#cb28-854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-855"><a href="#cb28-855" aria-hidden="true" tabindex="-1"></a><span class="in">conf_df$proportion &lt;- conf_df$Freq / conf_df$total</span></span>
<span id="cb28-856"><a href="#cb28-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-857"><a href="#cb28-857" aria-hidden="true" tabindex="-1"></a><span class="in"># fit model on complete data set</span></span>
<span id="cb28-858"><a href="#cb28-858" aria-hidden="true" tabindex="-1"></a><span class="in">best_rf_model &lt;- pred_model$finalModel</span></span>
<span id="cb28-859"><a href="#cb28-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-860"><a href="#cb28-860" aria-hidden="true" tabindex="-1"></a><span class="in"># all_rf_model &lt;- randomForest(</span></span>
<span id="cb28-861"><a href="#cb28-861" aria-hidden="true" tabindex="-1"></a><span class="in">#   subtype.label ~ .,</span></span>
<span id="cb28-862"><a href="#cb28-862" aria-hidden="true" tabindex="-1"></a><span class="in">#   data = elm_anns[, c(target_features, "subtype.label")],  # Your entire dataset</span></span>
<span id="cb28-863"><a href="#cb28-863" aria-hidden="true" tabindex="-1"></a><span class="in">#   proximity = TRUE,  # Include proximity matrix</span></span>
<span id="cb28-864"><a href="#cb28-864" aria-hidden="true" tabindex="-1"></a><span class="in">#   ntree = best_rf_model$ntree,  # Number of trees</span></span>
<span id="cb28-865"><a href="#cb28-865" aria-hidden="true" tabindex="-1"></a><span class="in">#   mtry = best_rf_model$mtry,    # Number of variables tried for splitting at each node</span></span>
<span id="cb28-866"><a href="#cb28-866" aria-hidden="true" tabindex="-1"></a><span class="in">#   nodesize = best_rf_model$nodesize,  # Minimum size of terminal nodes</span></span>
<span id="cb28-867"><a href="#cb28-867" aria-hidden="true" tabindex="-1"></a><span class="in">#   maxnodes = best_rf_model$maxnodes  # Maximum number of terminal nodes</span></span>
<span id="cb28-868"><a href="#cb28-868" aria-hidden="true" tabindex="-1"></a><span class="in"># )</span></span>
<span id="cb28-869"><a href="#cb28-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-870"><a href="#cb28-870" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-871"><a href="#cb28-871" aria-hidden="true" tabindex="-1"></a><span class="in">    list(</span></span>
<span id="cb28-872"><a href="#cb28-872" aria-hidden="true" tabindex="-1"></a><span class="in">        pred_model_bb = pred_model,</span></span>
<span id="cb28-873"><a href="#cb28-873" aria-hidden="true" tabindex="-1"></a><span class="in">        conf_mat_bb = conf_mat,</span></span>
<span id="cb28-874"><a href="#cb28-874" aria-hidden="true" tabindex="-1"></a><span class="in">        confusion_df_bb = conf_df,</span></span>
<span id="cb28-875"><a href="#cb28-875" aria-hidden="true" tabindex="-1"></a><span class="in">        testset_bb = testset</span></span>
<span id="cb28-876"><a href="#cb28-876" aria-hidden="true" tabindex="-1"></a><span class="in">        #all_rf_model = all_rf_model</span></span>
<span id="cb28-877"><a href="#cb28-877" aria-hidden="true" tabindex="-1"></a><span class="in">    )</span></span>
<span id="cb28-878"><a href="#cb28-878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-879"><a href="#cb28-879" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(</span></span>
<span id="cb28-880"><a href="#cb28-880" aria-hidden="true" tabindex="-1"></a><span class="in">    rf_model_results,</span></span>
<span id="cb28-881"><a href="#cb28-881" aria-hidden="true" tabindex="-1"></a><span class="in">    "./data/processed/random_forest_model_results_single_and_composed_subtypes.RDS"</span></span>
<span id="cb28-882"><a href="#cb28-882" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb28-883"><a href="#cb28-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-884"><a href="#cb28-884" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-885"><a href="#cb28-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-886"><a href="#cb28-886" aria-hidden="true" tabindex="-1"></a><span class="fu">### Checking performance on test data</span></span>
<span id="cb28-887"><a href="#cb28-887" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = TRUE}</span></span>
<span id="cb28-888"><a href="#cb28-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-889"><a href="#cb28-889" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results &lt;-</span></span>
<span id="cb28-890"><a href="#cb28-890" aria-hidden="true" tabindex="-1"></a><span class="in">    readRDS("./data/processed/random_forest_model_results_single_and_composed_subtypes.RDS")</span></span>
<span id="cb28-891"><a href="#cb28-891" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-892"><a href="#cb28-892" aria-hidden="true" tabindex="-1"></a><span class="in"># print confusion matrix results</span></span>
<span id="cb28-893"><a href="#cb28-893" aria-hidden="true" tabindex="-1"></a><span class="in">rf_model_results$conf_mat_bb</span></span>
<span id="cb28-894"><a href="#cb28-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-895"><a href="#cb28-895" aria-hidden="true" tabindex="-1"></a><span class="in">confusion_df &lt;- rf_model_results$confusion_df_bb</span></span>
<span id="cb28-896"><a href="#cb28-896" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-897"><a href="#cb28-897" aria-hidden="true" tabindex="-1"></a><span class="in">ggplot(confusion_df, aes(x = Reference, y = Prediction, fill = proportion)) +</span></span>
<span id="cb28-898"><a href="#cb28-898" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_tile() +</span></span>
<span id="cb28-899"><a href="#cb28-899" aria-hidden="true" tabindex="-1"></a><span class="in">    coord_equal() +</span></span>
<span id="cb28-900"><a href="#cb28-900" aria-hidden="true" tabindex="-1"></a><span class="in">    scale_fill_distiller(palette = "Greens", direction = 1) +</span></span>
<span id="cb28-901"><a href="#cb28-901" aria-hidden="true" tabindex="-1"></a><span class="in">    geom_text(aes(label = round(proportion, 2)), color = "black", size = 3) +</span></span>
<span id="cb28-902"><a href="#cb28-902" aria-hidden="true" tabindex="-1"></a><span class="in">    theme_classic() +</span></span>
<span id="cb28-903"><a href="#cb28-903" aria-hidden="true" tabindex="-1"></a><span class="in">    labs(x = "Observed", y = "Predicted") +</span></span>
<span id="cb28-904"><a href="#cb28-904" aria-hidden="true" tabindex="-1"></a><span class="in">    theme(axis.text.x = element_text(</span></span>
<span id="cb28-905"><a href="#cb28-905" aria-hidden="true" tabindex="-1"></a><span class="in">        color = "black",</span></span>
<span id="cb28-906"><a href="#cb28-906" aria-hidden="true" tabindex="-1"></a><span class="in">        size = 11,</span></span>
<span id="cb28-907"><a href="#cb28-907" aria-hidden="true" tabindex="-1"></a><span class="in">        angle = 30,</span></span>
<span id="cb28-908"><a href="#cb28-908" aria-hidden="true" tabindex="-1"></a><span class="in">        vjust = 0.8,</span></span>
<span id="cb28-909"><a href="#cb28-909" aria-hidden="true" tabindex="-1"></a><span class="in">        hjust = 0.8</span></span>
<span id="cb28-910"><a href="#cb28-910" aria-hidden="true" tabindex="-1"></a><span class="in">    ))</span></span>
<span id="cb28-911"><a href="#cb28-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-912"><a href="#cb28-912" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-913"><a href="#cb28-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-914"><a href="#cb28-914" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- light green box --&gt;</span></span>
<span id="cb28-915"><a href="#cb28-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-916"><a href="#cb28-916" aria-hidden="true" tabindex="-1"></a>::: {.alert .alert-success}</span>
<span id="cb28-917"><a href="#cb28-917" aria-hidden="true" tabindex="-1"></a><span class="fu"># Takeaways {#takeaways .unnumbered .unlisted}</span></span>
<span id="cb28-918"><a href="#cb28-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-919"><a href="#cb28-919" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Good classification of single element subtypes (accuracy: 0.76) </span>
<span id="cb28-920"><a href="#cb28-920" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Poor classification of composed subtypes (accuracy: 0.52 and 0.37 when including single-element subtypes)</span>
<span id="cb28-921"><a href="#cb28-921" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-922"><a href="#cb28-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-923"><a href="#cb28-923" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb28-924"><a href="#cb28-924" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-925"><a href="#cb28-925" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb28-926"><a href="#cb28-926" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-927"><a href="#cb28-927" aria-hidden="true" tabindex="-1"></a><span class="co">&lt;!-- '---' adds a gray vertical line --&gt;</span></span>
<span id="cb28-928"><a href="#cb28-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-929"><a href="#cb28-929" aria-hidden="true" tabindex="-1"></a>------------------------------------------------------------------------</span>
<span id="cb28-930"><a href="#cb28-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-931"><a href="#cb28-931" aria-hidden="true" tabindex="-1"></a>&nbsp;</span>
<span id="cb28-932"><a href="#cb28-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-933"><a href="#cb28-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-934"><a href="#cb28-934" aria-hidden="true" tabindex="-1"></a><span class="fu"># To-do list</span></span>
<span id="cb28-935"><a href="#cb28-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-936"><a href="#cb28-936" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Try other classification methods (VGGish, BirdNet, google model)</span>
<span id="cb28-937"><a href="#cb28-937" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>arreglar subtipos vacíos (NAs) y con etiquetas 5 y 44</span>
<span id="cb28-938"><a href="#cb28-938" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>buscar ejemplos específicos de subtipos raros para aumentar n de entrenamiento</span>
<span id="cb28-939"><a href="#cb28-939" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>buscar grabaciones completas (o cortes) con subtipos raros para n de prueba</span>
<span id="cb28-940"><a href="#cb28-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-941"><a href="#cb28-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE, echo=FALSE}</span></span>
<span id="cb28-942"><a href="#cb28-942" aria-hidden="true" tabindex="-1"></a><span class="in"># Flats: sin cambios de frecuencia iguales o mayores a 5 kHz dentro del mismo llamado. </span></span>
<span id="cb28-943"><a href="#cb28-943" aria-hidden="true" tabindex="-1"></a><span class="in"># Trill: 1 cambio de frecuencia mayor o igual a 5 kHz, 2 cambios de 4 kHz, 3 o más cambios de 3 kHz cada uno.</span></span>
<span id="cb28-944"><a href="#cb28-944" aria-hidden="true" tabindex="-1"></a><span class="in"># Steps: Un cambio igual o mayor a 5 kHz entre cada componente y no deben estar distanciadas más de 0.05 segundos (50 milisegundos). </span></span>
<span id="cb28-945"><a href="#cb28-945" aria-hidden="true" tabindex="-1"></a><span class="in"># Con éstos criterios se hacen todas las demás combinaciones de trills-trills, step-flats, step-trills, etc. </span></span>
<span id="cb28-946"><a href="#cb28-946" aria-hidden="true" tabindex="-1"></a><span class="in"># </span></span>
<span id="cb28-947"><a href="#cb28-947" aria-hidden="true" tabindex="-1"></a><span class="in"># Si ud ya tiene los flats (1), trills (4) y complex (6), solo es necesario sacar los que son step-flats, step-trills y trills-trills.</span></span>
<span id="cb28-948"><a href="#cb28-948" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-949"><a href="#cb28-949" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb28-950"><a href="#cb28-950" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-951"><a href="#cb28-951" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-952"><a href="#cb28-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-953"><a href="#cb28-953" aria-hidden="true" tabindex="-1"></a>&lt;font size="4"&gt;Session information&lt;/font&gt;</span>
<span id="cb28-954"><a href="#cb28-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-955"><a href="#cb28-955" aria-hidden="true" tabindex="-1"></a><span class="in">```{r session info, echo=F}</span></span>
<span id="cb28-956"><a href="#cb28-956" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-957"><a href="#cb28-957" aria-hidden="true" tabindex="-1"></a><span class="in">sessionInfo()</span></span>
<span id="cb28-958"><a href="#cb28-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-959"><a href="#cb28-959" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>